function createBarGraph(t,e){x.domain(e.map(function(t){return t.category})),y.domain([0,d3.max(e,function(t){return t.value})]),y.nice(),yAxis.scale(y),created?svg.selectAll(".bar").data(e).transition().duration(1e3).attr("y",function(t){return y(t.value)}).attr("height",function(t){return height-y(t.value)}):svg.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",function(t){return x(t.category)}).attr("width",x.bandwidth()).attr("y",function(t){return y(t.value)}).attr("height",function(t){return height-y(t.value)}),created?svg.select(".yAxis").transition().duration(1e3).call(yAxis):(svg.append("g").attr("transform","translate(0,"+height+")").call(d3.axisBottom(x)),svg.append("g").attr("class","yAxis").call(yAxis)),created?svg.select("#bar-title").text(t):svg.append("text").attr("x",width/2).attr("y",0-margin.top/2).attr("id","bar-title").attr("text-anchor","middle").style("font-size","24px").text(t),created=!0}function GroupedBarData(t,e,r,n,a,o){this.x0=t,this.x1=e,this.y=r,this.yAxis=n,this.svg=a,this.id=o,this.created=!1}function highlight(t,e){d3.selectAll(".bar-selected").datum(function(t){return t}).attr("fill",function(t){return z(t.key)}),d3.selectAll(".bar-selected").classed("bar-selected",!1),e||d3.selectAll("rect."+t.replace(/ /g,"")).classed("bar-selected",!0).datum(function(t){return t}).attr("fill",function(t){return zSelected(t.key)})}function createdGroupedBarGraph(t,e,r,n){var a=null;barGraphs.forEach(function(t){t.id===n&&(a=t)}),null===a&&(a=new GroupedBarData(d3.scaleBand().rangeRound([0,width]).paddingInner(.05),d3.scaleBand().padding(.05),d3.scaleLinear().rangeRound([height,0]),d3.axisLeft(),d3.axisBottom(),n),barGraphs.push(a)),a.created||(a.svg=d3.select(n).append("div").classed("svg-container",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+(width+margin.left+margin.right)+" "+(height+margin.top+margin.bottom)).append("g").attr("transform","translate("+margin.left+","+margin.top+")").classed("svg-content-responsive",!0)),a.x0.domain(t.map(function(t){return t.edb})),a.x1.domain(e).rangeRound([0,a.x0.bandwidth()]),a.y.domain([0,d3.max(t,function(t){return d3.max(e,function(e){return Math.abs(t[e])})})]).nice();var o=a.svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),i=d3.format(".2f"),s=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return"<strong>Value:</strong> <span style='color:lightgreen'>"+i(t.value)+"</span><br><br><strong>Year:</strong> <span style='color:lightgreen'>"+t.key+"</span>"});a.svg.call(s),a.created?o.append("g").selectAll("g").data(t).attr("transform",function(t){return"translate("+a.x0(t.edb)+",0)"}).selectAll("rect").data(function(t){return e.map(function(e){return{neg:t[e]<0,key:e,value:Math.abs(t[e])}})}).enter().append("rect").attr("x",function(t){return a.x1(t.key)}).attr("y",function(t){return a.y(t.value)}).attr("width",a.x1.bandwidth()).attr("height",function(t){return height-a.y(t.value)}).attr("fill",function(t){return t.neg?zRed(t.key):z(t.key)}).on("mouseover",s.show).on("mouseout",s.hide):o.append("g").selectAll("g").data(t).enter().append("g").attr("transform",function(t){return"translate("+a.x0(t.edb)+",0)"}).selectAll("rect").data(function(t){return e.map(function(e){return{neg:t[e]<0,key:e,edb:t.edb,value:Math.abs(t[e])}})}).enter().append("rect").attr("x",function(t){return a.x1(t.key)}).attr("y",function(t){return a.y(t.value)}).attr("width",a.x1.bandwidth()).attr("height",function(t){return height-a.y(t.value)}).attr("fill",function(t){return t.neg?zRed(t.key):z(t.key)}).attr("class",function(t){return""+t.edb.replace(/ /g,"")}).on("mouseover",s.show).on("mouseout",s.hide),o.append("g").attr("class","axis").attr("transform","translate(0,"+height+")").call(d3.axisBottom(a.x0)).selectAll("text").attr("y",0).attr("x",9).attr("dy",".35em").attr("class","axis-text").attr("transform","rotate(55)").style("font-size","8px").style("text-anchor","start"),a.created?a.svg.select(".yAxis").call(a.yAxis):o.append("g").attr("class","axis yAxis y-group").call(a.yAxis.scale(a.y).ticks(null,"s")).append("text").attr("x",2).attr("y",a.y(a.y.ticks().pop())+.5).attr("dy","0.32em").attr("text-anchor","start"),a.svg.append("text").attr("text-anchor","middle").attr("transform","translate("+(margin.left/2-5)+","+(margin.top+8)+")rotate(-90)").style("font-size","10px").attr("class","unit-text").text(r);var c=o.append("g").attr("font-family","sans-serif").attr("font-size",8).attr("text-anchor","end").selectAll("g").data(e.slice().reverse()).enter().append("g").attr("transform",function(t,e){return"translate(0,"+10*e+")"});c.append("rect").attr("x",width-100).attr("width",8.5).attr("height",8.5).attr("fill",z),c.append("text").attr("x",width-110).attr("y",4).attr("dy","0.32em").attr("class","g-text").style("font-size","8px").text(function(t){return t}),a.created=!0}function BoxPlotData(t,e,r,n,a,o,i,s){this.x=t,this.y=e,this.xAxis=r,this.yAxis=n,this.svg=a,this.chart=o,this.created=i,this.id=s}function createBoxPlot(t,e,r){var n=null,a=t.data,o=t.min,i=t.max,s=t.scatterData;if(plots.forEach(function(t){t.id===e&&(n=t)}),null===n){var c=d3.scaleBand().rangeRound([0,boxWidth]).padding(.7,.3);n=new BoxPlotData(c,null,null,null,null,null,!1,e),plots.push(n)}else d3.select(e+" svg").remove();n.y=d3.scaleLinear().domain([o,i]).nice().range([boxHeight+boxMargin.top,0+boxMargin.top]),n.chart=d3.box().whiskers(iqr(1.5)).height(boxHeight).domain(n.y.domain()).showLabels(labels),n.svg=d3.select(e).append("div").classed("svg-container-box",!0).append("svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 "+(boxWidth+boxMargin.left+boxMargin.right)+" "+(boxHeight+boxMargin.top+boxMargin.bottom)).attr("class","box").append("g").attr("transform","translate("+margin.left+","+margin.top+")").classed("svg-content-responsive",!0),n.x.domain(a.map(function(t){return t[0]})),n.xAxis=d3.axisBottom(n.x),n.yAxis=d3.axisLeft(n.y),n.svg.selectAll(".box").data(a).enter().append("g").attr("transform",function(t){return"translate("+n.x(t[0])+","+boxMargin.top+")"}).call(n.chart.width(n.x.bandwidth())),n.svg.selectAll(".box").data(a).enter().append("g").attr("transform",function(t){return"translate("+n.x(t[0])+","+boxMargin.top+")"}).call(n.chart.width(n.x.bandwidth()));var l=d3.format(".2f"),d=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return"<strong>Value:</strong> <span style='color:lightgreen'>"+l(t.value)+"</span><br><br><strong>EDB:</strong> <span style='color:lightgreen'>"+t.edb+"</span>"});n.svg.call(d),n.svg.selectAll(".dot").data(s).enter().append("circle").attr("class",function(t){return"dot "+t.edb.replace(/ /g,"")}).attr("r",1.75).attr("cx",function(t){return n.x(t.year)+whiskBoxWidth/2}).attr("cy",function(t){return n.y(t.value)}).on("mouseover",d.show).on("mouseout",d.hide),n.svg.append("g").attr("class","y axis").call(n.yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("font-size","8px"),n.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(boxHeight+boxMargin.top+10)+")").call(n.xAxis).append("text").attr("x",boxWidth/2).attr("y",10).attr("dy",".71em").style("text-anchor","middle").style("font-size","8px").text("Quarter"),n.svg.append("text").attr("text-anchor","middle").attr("transform","translate("+-(boxMargin.left/2-10)+","+(2*boxMargin.top+10)+")rotate(-90)").style("font-size","12px").attr("class","unit-text").text(r),n.svg.append("text").attr("text-anchor","middle").attr("transform","translate("+ +(boxWidth/2)+","+(boxMargin.top+40+boxHeight)+")").style("font-size","12px").attr("class","unit-text").text("Year"),n.created=!0}function iqr(t){return function(e,r){for(var n=e.quartiles[0],a=e.quartiles[2],o=(a-n)*t,r=-1,i=e.length;e[++r]<n-o;);for(;e[--i]>a+o;);return[r,i]}}function loadFromURL(t){loadInSections(!0,t),lastSearch=new Selection(t[0],t[1],t[2],t[3]),$.post("/compare/search",{company:selectedCompany,selections:JSON.stringify(t)},function(e){t.forEach(function(t){setSelectionsFromURL(t)}),dataTables=filterRowsToTables(e.rows),copyOfDataTables=copyDataTables(dataTables),createDataStructuresWithCopy(copyOfDataTables),showTables(selectionTablesArray),showAllRegularGraphs(selectionDataArray,!0),showAllCombinedGraphs(combinedSelectionDataArray,!0)})}function validateSearchParams(t){var e=!0;return t.forEach(function(t,r){""===t.subCategory&&validOptions[r]&&(e=!1),""!==t.section&&""!==t.category&&""!==t.description||""===t.section&&""===t.category&&""===t.description||($("#error-div").append('<h4 style="color : red;">Partial Row Selected</h4>'),e=!1)}),e&&$("#error-div").html(""),e}function copyDataTables(t){for(var e=[t.tableA,t.tableB,t.tableC,t.tableD,t.tableAB,t.tableCD],r=[[],[],[],[],[],[]],n=0;n<e.length;n++){var a=e[n];if(void 0!==a)for(var o=0;o<a.length;o++)r[n].push({category:a[o].category,description:a[o].description,disc_yr:a[o].disc_yr,edb:a[o].edb,fcast_yr:a[o].fcast_yr,network:a[o].network,note:a[o].note,obs_yr:a[o].obs_yr,p_key:a[o].p_key,sch_ref:a[o].sch_ref,schedule:a[o].schedule,section:a[o].section,sub_category:a[o].sub_category,units:a[o].units,value:a[o].value})}return new DataTables(r[0],r[1],r[2],r[3],r[4],r[5])}function createDataStructuresWithCopy(t){selectionDataArray=[],selectionTablesArray=[],combinedSelectionDataArray=[];for(var e=[t.tableA.length>0,t.tableB.length>0,t.tableC.length>0,t.tableD.length>0],r=[t.tableA,t.tableB,t.tableC,t.tableD,t.tableAB,t.tableCD],n=["a","b","c","d","ab","cd"],a=0;a<e.length;a++)if(e[a]){var o=r[a][0].section+", "+r[a][0].category,i=null===r[a][0].sub_category?r[a][0].description:r[a][0].sub_category+", "+r[a][0].description;if(selectionTablesArray.push(new SelectedTableData(r[a],n[a],o,i,r[a][0].units)),selectionDataArray.push(new SelectionData(r[a],o,i,r[a][0].units,n[a])),("a"===n[a]||"c"===n[a])&&e[a+1]){var s=0===a?4:3,c=r[a+1][0].section+", "+r[a+1][0].category,l=null===r[a+1][0].sub_category?r[a+1][0].description:r[a+1][0].sub_category+", "+r[a+1][0].description;selectionTablesArray.push(new SelectedTableData(r[a+s],n[a+s],o+", "+i,c+", "+l,r[a+1][0].units)),combinedSelectionDataArray.push(new SelectionDataCombined(r[a+s],r[a],r[a+1],o+" "+i,c+" "+l,r[a][0].units,r[a+1][0].units,n[a+s]))}}}function showTables(t){t.forEach(function(t){$("#title-"+t.id).append('<h2 class="title">'+t.title+"</h2>").append('<h4 class="subTitle">'+t.subTitle+"</h4>"),insertTable(t.rows,"table"+t.id),insertTotalsTable(t.rows,"table-total"+t.id,regions,!1)})}function filterRowsToTables(t){var e=t.filter(function(t){return matchDBRow(t,lastSearch.aTable)}),r=t.filter(function(t){return matchDBRow(t,lastSearch.bTable)}),n=t.filter(function(t){return matchDBRow(t,lastSearch.cTable)}),a=t.filter(function(t){return matchDBRow(t,lastSearch.dTable)});if(e.forEach(function(t){null===t.value&&(t.value=0)}),r.forEach(function(t){null===t.value&&(t.value=0)}),n.forEach(function(t){null===t.value&&(t.value=0)}),a.forEach(function(t){null===t.value&&(t.value=0)}),e.length>0&&r.length>0)var o=combineTables(e,r);if(n.length>0&&a.length>0)var i=combineTables(n,a);return new DataTables(e,r,n,a,o,i)}function showAllRegularGraphs(t,e){t.forEach(function(t){e&&($("#title-"+t.id+"-bar").append('<h3 class="title">'+t.title+"</h3>").append('<h4 class="subTitle">'+t.subTitle+"</h4>"),$("#title-"+t.id+"-box").append('<h3 class="title">'+t.title+"</h3>").append('<h4 class="subTitle">'+t.subTitle+"</h4>"));var r=createDataForGroupedGraph(t.rows);createdGroupedBarGraph(r.data,r.keys,t.unit,"#grouped-bar-"+t.id),createBoxPlot(createDataForBoxPlot(t.rows),"#boxplot"+t.id+"-div",t.unit),$("#full-table-"+t.id+"-div").show()})}function showAllCombinedGraphs(t,e){t.forEach(function(t){e&&($("#title-"+t.id+"-bar").append('<h4 class="combined-title">'+t.title1+'<br><span class="over">over</span><br>'+t.title2+"</h4>"),$("#title-"+t.id+"-box").append('<h4 class="combined-title">'+t.title1+' <br><span class="over">over</span><br>'+t.title2+"</h4>"),$("#title-"+t.id+"-vector").append('<h4 class="combined-title">'+t.title1+'<br><span class="over">over</span><br>'+t.title2+"</h4>"));var r=createDataForGroupedGraph(t.rows);createdGroupedBarGraph(r.data,r.keys,t.unit1+" / "+t.unit2,"#grouped-bar-"+t.id),createBoxPlot(createDataForBoxPlot(t.rows),"#boxplot"+t.id+"-div",t.unit1+" / "+t.unit2),createVectorGraph(createDataForVectorGraph(t.table1Rows,t.table2Rows),t.unit1,t.unit2,"#vector-graph-div-"+t.id),$("#full-table-"+t.id+"-div").show()}),2===t.length&&($("#title-abcd-vec").append('<h4 class="combined-title">'+t[0].title1+" / "+t[0].title2+"</h4>").append("<h4>Over</h4>").append('<h4 class="combined-title">'+t[1].title1+" / "+t[1].title2+"</h4>"),createVectorGraph(createDataForVectorGraph(t[0].rows,t[1].rows),t[0].unit1+" / "+t[1].unit1,t[0].unit2+" / "+t[1].unit2,"#vector-graph-div-abcd"),$("#vector-full-div-abcd").show())}function combineTables(t,e){for(var r=[],n=t,a=e,o=0;o<n.length;o++)for(var i=0;i<a.length;i++)if(n[o].edb===a[i].edb&&n[o].obs_yr===a[i].obs_yr&&n[o].disc_yr===a[i].disc_yr){r.push({disc_yr:a[i].disc_yr,edb:a[i].edb,obs_yr:a[i].obs_yr,value:n[o].value/("0"===a[i].value||0===a[i].value?1:a[i].value),section:a[i].section+""+a[i].description+" over ",description:n[o].section+" "+n[o].description,unitA:n[o].units,unitB:a[i].units,unit:n[o].units+" / "+a[i].units});break}return r}function insertTotalsTable(t,e,r,n){var a=[];n&&$("#"+e).html("");var o=[];t.forEach(function(t){o.includes(t.obs_yr)||o.push(t.obs_yr)}),o.sort(function(t,e){return+t-+e});for(var i=["n","uni","eni","swni","s","usi","lsi"],s={n:"North Island",uni:"Upper North Island",eni:"Eastern North Island",swni:"South-West North Island",s:"South Island",usi:"Upper South Island",lsi:"Lower South Island",nz:"New Zealand"},c={},l=0;l<o.length;l++)t.filter(function(t){return t.obs_yr===o[l]}).forEach(function(t){i.forEach(function(e){r[e].includes(t.edb)&&(void 0===c[e]?c[e]=[+t.value]:l===c[e].length?c[e].push(+t.value):c[e][l]+=+ +t.value)})});for(var d=[],l=0;l<o.length;l++)d.push(c.n[l]+c.s[l]);c.nz=d;var u="";o.forEach(function(t){u+="<th>"+t+"</th>"});var p=0;$("#"+e).append('<tr id="head-row-totals-"'+e+' class="table-row table-head"> <th>Region</th>'+u+"</tr>");for(var h in c)if(c.hasOwnProperty(h)){var f="<tr class='table-row' id=row-tot-"+e+l+">";f+="<th class='reg-cell'>"+s[h]+"</th>",c[h].forEach(function(t){f+="<th id='t-total"+e+p+"' origValue='"+t/r[h].length+"' class='val-tot-cell'>"+dpFormat(t/r[h].length)+"</th>",a.push({id:"#t-total"+e+p,value:t/r[h].length}),n||noCPICells.push({id:"t-total"+e+p,value:t/r[h].length}),p++}),$("#"+e).append(f)}applyGradientCSS(a,!1)}function insertTable(t,e){if(t.sort(function(t,e){return[t.edb,e.edb].sort()[0]===t.edb?-1:1}),0!==t.length){var r=[];t.forEach(function(t){r.includes(t.obs_yr)||r.push(t.obs_yr)}),r.sort(function(t,e){return+t-+e});var n=(t.reduce(function(t,e){return t.obs_yr<e.obs_yr?t:e}).obs_yr,t.reduce(function(t,e){return t.obs_yr>e.obs_yr?t:e}).obs_yr,"");r.forEach(function(t){n+="<th>"+t+"</th>"}),$("#"+e).append('<tr id="head-row" class="table-row table-head"> <th>EDB</th>'+n+"</tr>");for(var a=[],o=[],i=0,s=[],c=0;c<t.length;c++)if(!a.includes(t[c].edb)){a.push(t[c].edb);var l="<tr class='table-row' id=row"+e+c+">";l+="<th class='edb-cell'>"+t[c].edb+"</th>";for(var d=0;d<r.length;d++){for(var u=0;u<t.length;u++)t[u].edb!==t[c].edb||t[u].obs_yr!==r[d]||o.includes(t[u].obs_yr)||(o.push(t[u].obs_yr),l+="<th origValue='"+t[u].value+"' class='cell "+r[d]+"' id='t"+e+i+"'>"+dpFormat(t[u].value)+"</th>",s.push({id:"#t"+e+i,value:t[u].value}),i++);o=[]}$("#"+e).append(l+"</tr>"),$("#row"+e+c).click(function(t){rowClicked(this.id)})}var p=!0;p=!1,applyGradientCSS(s,p)}}function rowClicked(t){if(rowSelected===t){var e=$("#"+t+" .edb-cell").text();return highlight(e,!0),$(".table").find("tr").removeClass("row-selected"),d3.selectAll(".line-selected-table").classed("line-selected",!1),d3.selectAll(".vec-dot-selected").classed("vec-dot-selected",!1),void(rowSelected="")}rowSelected=t;var e=$("#"+t+" .edb-cell").text();$(".table").find("tr").removeClass("row-selected"),$("#"+t).addClass("row-selected");$("#"+t+".edb-cell").text();d3.selectAll(".line-selected-table").classed("line-selected",!1),d3.selectAll(".vec-dot-selected").classed("vec-dot-selected",!1),highlight(e,!1),d3.selectAll("line."+e.replace(/ /g,"")).classed("line-selected-table",!0),d3.selectAll(".dot."+e.replace(/ /g,"")).classed("vec-dot-selected",!0)}function applyGradientCSS(t,e){var r=-(1/0);t.forEach(function(t){r=+t.value>r?+t.value:r});for(var n=0;n<t.length;n++){var a=e?a:+t[n].value/r*100;$(t[n].id).css({background:"-webkit-gradient(linear, left top, right top, color-stop("+a+"%,#7bbfd6), color-stop("+a+"%,#FFF))"})}}function matchDBRow(t,e){return t.section===e.section&&t.category===e.category&&t.description===e.description&&(null===t.sub_category||e.subCategory===t.sub_category)}function search(){if(validateSearchParams(selections)){var t={i0:selections[0].id,s0:selections[0].section,c0:selections[0].category,sc0:selections[0].subCategory,d0:selections[0].description,i1:selections[1].id,s1:selections[1].section,c1:selections[1].category,sc1:selections[1].subCategory,d1:selections[1].description,i2:selections[2].id,s2:selections[2].section,c2:selections[2].category,sc2:selections[2].subCategory,d2:selections[2].description,i3:selections[3].id,s3:selections[3].section,c3:selections[3].category,sc3:selections[3].subCategory,d3:selections[3].description};params=serialise(t),window.location.replace("compare?"+params)}}function search2(){if(validateSearchParams(selections)){var t={};selections.forEach(function(e){""!==e.section&&(t["s"+e.id]=e.section,t["c"+e.id]=e.category,t["sc"+e.id]=e.subCategory,t["d"+e.id]=e.description)}),params=serialise(t),window.location.replace("compare?"+params)}}function serialise(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e.join("&")}function createDataForVectorGraph(t,e){var r=t,n=e,a=[],o=[],i=[];t.forEach(function(t){if(!i.includes(t.obs_yr))for(var r=0;r<e.length;r++)if(e[r].obs_yr===t.obs_yr){i.push(t.obs_yr);break}});for(var s=0;s<r.length;s++)if(!a.includes(r[s].edb)){var c=r.filter(function(t){return t.edb===r[s].edb}),l=n.filter(function(t){return t.edb===r[s].edb});a.push(r[s].edb);for(var d=[],u=[],p=0;p<c.length;p++)if(!d.includes(c[p].disc_yr)&&i.includes(c[p].disc_yr)){d.push(c[p].disc_yr);var h=c.filter(function(t){return t.disc_yr===c[p].disc_yr}),f=l.filter(function(t){return t.disc_yr===c[p].disc_yr});if(h.length!=f.length)return[];for(var g=0;g<h.length;g++)u.push({year:+h[g].disc_yr,valueA:+h[g].value,valueB:+f[g].value})}u.sort(function(t,e){return t.year-e.year}),o.push({edb:r[s].edb,years:u})}return o}function createDataForBoxPlot(t){for(var e=[],r=[],n=0;n<t.length;n++)e.includes(t[n].obs_yr)||(r.push(t.filter(function(e){return e.obs_yr===t[n].obs_yr})),e.push(t[n].obs_yr));for(var a=[],o=[],i=1/0,s=-(1/0),n=0;n<r.length;n++){var c=[];c[0]=""+r[n][0].obs_yr;for(var l=""+r[n][0].obs_yr,d=[],u=0;u<r[n].length;u++){var p=+r[n][u].value,h=r[n][u].edb;p>s&&(s=p),p<i&&(i=p),d.push(p),o.push({year:l,edb:h,value:p})}c[1]=d,a.push(c)}return a.sort(function(t,e){return t[0]-e[0]}),{min:i,max:s,data:a,scatterData:o}}function createDataForGroupedGraph(t){var e=[];t.forEach(function(t){e.includes(t.obs_yr)||e.push(t.obs_yr)}),e.sort(function(t,e){return+t-+e});for(var r=[],n=[],a=0;a<t.length;a++)if(n.includes(t[a].edb))for(var o=0;o<r.length;o++)r[o].edb===t[a].edb&&(r[o][t[a].obs_yr]=+t[a].value);else{n.push(t[a].edb);var i={edb:t[a].edb};i[t[a].obs_yr]=+t[a].value,r.push(i)}return{data:r,keys:e}}function setSelectionsFromURL(t){$.post("/sections/s",{selected:t.section},function(e){e.categories.length>0&&null!==e.categories[0]&&$("#category-select"+t.id).html("");for(var r=0;r<e.categories.length;r++)e.categories[r]===t.category?$("#category-select"+t.id).append('<option value="'+e.categories[r]+'"selected>'+e.categories[r]+"</option>"):$("#category-select"+t.id).append('<option value="'+e.categories[r]+'">'+e.categories[r]+"</option>");$(".selectpicker").selectpicker("refresh")}),$.post("/sections/sc",{section:t.section,category:t.category},function(e){if(e.subCategories.length>0&&null!==e.subCategories[0]){$("#subsection-select"+t.id).html(""),validOptions[t.id]=!0;for(var r=0;r<e.subCategories.length;r++)e.subCategories[r]===t.subCategory?$("#subsection-select"+t.id).append("<option selected>"+e.subCategories[r]+"</option>"):$("#subsection-select"+t.id).append("<option>"+e.subCategories[r]+"</option>");$(".selectpicker").selectpicker("refresh")}}),$.post("/sections/desc",{category:t.category,section:t.section,subCategory:t.subCategory},function(e){if(e.descriptions.length>0&&null!==e.descriptions[0]){$("#description-select"+t.id).html("");for(var r=0;r<e.descriptions.length;r++)e.descriptions[r]===t.description?$("#description-select"+t.id).append("<option selected>"+e.descriptions[r]+"</option>"):$("#description-select"+t.id).append("<option>"+e.descriptions[r]+"</option>");$(".selectpicker").selectpicker("refresh")}})}function sortSections(t){t.sections.sort(function(t,e){for(var r=0;!isNaN(t.charAt(r));)r++;var n=t.substring(0,r);for(r=0;!isNaN(e.charAt(r));)r++;var a=e.substring(0,r);return n!==a?n-a:[t,e].sort()[0]===t?-1:1})}function loadInSections(t,e){$.get("/sections/sections",function(r){if(addSection(0),addSection(1),addSection(2),addSection(3),t)for(var n=0;n<e.length;n++)selections[n].description=e[n].description,selections[n].category=e[n].category,selections[n].section=e[n].section,selections[n].subCategory=e[n].subCategory;sortSections(r);for(var n=0;n<selections.length;n++){for(var a=0;a<r.sections.length;a++)t&&e[n].section===r.sections[a]?($("#section-select"+selections[n].id).append("<option selected>"+r.sections[a]+"</option>"),validOptions[selections[n].id]=!0):$("#section-select"+selections[n].id).append("<option>"+r.sections[a]+"</option>");$(".selectpicker").selectpicker("refresh")}})}function addSection(t){var e=["A","B","C","D","E"];$("#compare-div").append('<div class="row" id="titleRow'+t+'"><div class="col-md-12"><h5  class="selection-title">Make a selection for table '+e[t]+"</h5> </div></div>"),$("#compare-div").append('<div class="row" id="row'+t+'">'),$("#row"+t).append('<div class="col-md-12 compare-col" id="col'+t+'">'),$("#col"+t).append('<select data-width="250px" class="selectpicker select-compare"  title="Section" id="section-select'+t+'"></select>'),selections.push({id:t,section:"",category:"",subCategory:"",description:""}),$("#section-select"+t).on("change",function(e){var r=$(this).find("option:selected").text(),n=e.target.id.charAt(e.target.id.length-1);$("#category-select"+n).html(""),$("#subsection-select"+n).html(""),$("#description-select"+n).html(""),selections[n]={id:t,section:"",category:"",subCategory:"",description:""},validOptions[n]=!1,$.post("/sections/s",{selected:r},function(t){t.categories.length>0&&null!==t.categories[0]&&$("#category-select"+n).html("");for(var e=0;e<t.categories.length;e++)null!==t.categories[e]&&$("#category-select"+n).append("<option>"+t.categories[e]+"</option>");$(".selectpicker").selectpicker("refresh")}),addToSelection(n,"section",r)}),$("#col"+t).append('<select data-width="190px" class="selectpicker select-compare" title="Category" id="category-select'+t+'"></select>'),$("#category-select"+t).on("change",function(t){var e=$(this).find("option:selected").text(),r=t.target.id.charAt(t.target.id.length-1);$("#description-select"+r).html(""),$.post("/sections/sc",{section:selections[r].section,category:e},function(t){if(!(t.subCategories.length>0&&null!==t.subCategories[0]))return void $.post("/sections/desc",{category:category,section:selections[r].section,subCategory:""},function(t){if(t.descriptions.length>0&&null!==t.descriptions[0]){$("#description-select"+r).html("");for(var e=0;e<t.descriptions.length;e++)$("#description-select"+r).append("<option>"+t.descriptions[e]+"</option>");$(".selectpicker").selectpicker("refresh")}});$("#subsection-select"+r).html(""),validOptions[r]=!0;for(var e=0;e<t.subCategories.length;e++)$("#subsection-select"+r).append("<option>"+t.subCategories[e]+"</option>");$(".selectpicker").selectpicker("refresh"),$(".selectpicker").selectpicker("refresh")}),addToSelection(r,"category",e),$(".selectpicker").selectpicker("refresh")}),$("#col"+t).append('<select data-width="190px" class="selectpicker select-compare" title="Subsection" id="subsection-select'+t+'"></select>'),$("#subsection-select"+t).on("change",function(t){var e=t.target.id.charAt(t.target.id.length-1),r=$(this).find("option:selected").text();$.post("/sections/desc",{category:selections[e].category,section:selections[e].section,subCategory:r},function(t){if(t.descriptions.length>0&&null!==t.descriptions[0]){$("#description-select"+e).html("");for(var r=0;r<t.descriptions.length;r++)$("#description-select"+e).append("<option>"+t.descriptions[r]+"</option>");$(".selectpicker").selectpicker("refresh")}}),addToSelection(e,"subcategory",r)}),$("#col"+t).append('<select data-width="190px" class="selectpicker select-compare" title="Description" id="description-select'+t+'"></select>'),$("#description-select"+t).on("change",function(t){var e=t.target.id.charAt(t.target.id.length-1),r=$(this).find("option:selected").text();addToSelection(e,"description",r)}),$("#col"+t).append('<button type="button" id="clear-'+t+'" class="btn btn-danger">Clear</button>').on("click",function(t){var e=t.target.id.charAt(t.target.id.length-1);clearSelection(e)})}function clearSelection(t){selections[t]={id:t,section:"",category:"",subCategory:"",description:""},validOptions[t]=!1,$("#description-select"+t).html(""),$("#subsection-select"+t).html(""),$("#category-select"+t).html(""),$("#section-select"+t).find("option:selected").removeAttr("selected"),$(".selectpicker").selectpicker("refresh")}function addToSelection(t,e,r){for(var n=0;n<selections.length;n++)selections[n].id+""==t+""&&("section"===e?selections[n].section=r:"category"===e?selections[n].category=r:"subcategory"===e?selections[n].subCategory=r:"description"===e&&(selections[n].description=r))}function cpiValidationSetup(){$.validator.setDefaults({errorClass:"help-block",highlight:function(t){$(t).closest(".form-group").addClass("has-error")},unhighlight:function(t){$(t).closest(".form-group").removeClass("has-error")}});var t={required:!0,number:!0,min:0,max:100},e={required:"Please enter a percentage",number:"Please enter a valid number",min:"Please enter a percentage greater than 0",max:"Please enter a percentage less than 100"};$("#cpi-form").validate({rules:{Y2012:t,Y2013:t,Y2014:t,Y2015:t,Y2016:t},messages:{Y2012:e,Y2013:e,Y2014:e,Y2015:e,Y2016:e}})}function applyCPI(t){if($("#cpi-form").valid()){noCPICells.length>0&&(revertCPI(),copyOfDataTables=copyDataTables(dataTables),createDataStructuresWithCopy(copyOfDataTables));var e=[{year:2012,value:+$("#Y2012").val()},{year:2013,value:+$("#Y2013").val()},{year:2014,value:+$("#Y2014").val()},{year:2015,value:+$("#Y2015").val()},{year:2016,value:+$("#Y2016").val()}];selectionTablesArray.forEach(function(t){t.unit.includes("$")&&applyCPIToTable("#table"+t.id,e)}),selectionDataArray.forEach(function(t){t.unit.includes("$")&&applyCPIToTableRows(t.rows,e)}),selectionTablesArray.forEach(function(t){insertTotalsTable(t.rows,"table-total"+t.id,regions,!0)}),showAllRegularGraphs(selectionDataArray,!1),showAllCombinedGraphs(combinedSelectionDataArray,!1)}}function applyCPIToTableRows(t,e){for(var r=t.reduce(function(t,e){return t.disc_yr<e.disc_yr?t:e}).obs_yr,n=t.reduce(function(t,e){return t.disc_yr>e.disc_yr?t:e}).obs_yr,a=r;a<=n;a++)t.forEach(function(r,n){for(var o=t[n].obs_yr,i=t[n].value,s=0;s<e.length;s++)e[s].year===a&&o<=a&&(i*=1+e[s].value/100);t[n].value=i})}function applyCPIToTable(t,e){$(".cell",t).each(function(){noCPICells.push({id:$(this).attr("id"),value:$(this).text()})});var r=1/0,n=-(1/0);$(".cell",t).each(function(){var t=+$(this).attr("class").split(" ")[1];r=t<r?t:r,n=t>n?t:n});for(var a=r;a<=n;a++)$(".cell",t).each(function(t){for(var r=+$(this).attr("class").split(" ")[1],n=$(this).attr("origvalue"),o=0;o<e.length;o++)e[o].year===a&&r<=a&&(n*=1+e[o].value/100,n=dpFormat(n));$(this).text(n)});applyGradientCSS(noCPICells)}function revertCPI(){noCPICells.forEach(function(t){$("#"+t.id).text(t.value)}),applyGradientCSS(noCPICells)}function Selection(t,e,r,n){this.aTable=t,this.bTable=e,this.cTable=r,this.dTable=n}function DataTables(t,e,r,n,a,o){this.tableA=t,this.tableB=e,this.tableC=r,this.tableD=n,this.tableAB=a,this.tableCD=o}function SelectionData(t,e,r,n,a){this.rows=t,this.title=e,this.subTitle=r,this.id=a,this.unit=n}function SelectionDataCombined(t,e,r,n,a,o,i,s){this.rows=t,this.title1=n,this.title2=a,this.unit1=o,this.unit2=i,this.id=s,this.table1Rows=e,this.table2Rows=r}function SelectedTableData(t,e,r,n,a){this.rows=t,this.id=e,this.title=r,this.subTitle=n,this.unit=a}function applyCPI(){return console.log("Apply CPI"),!1}function insertDataTable(t){console.log("Inserting table"),$("#results-table").append("<caption>"+t[0].description+"</caption>");var e=!1;null!==t[0].obs_yr?(console.log("Observed"),e=!0):null!==t[0].fcast_yr&&console.log("Forecast");var r=null,n=null;e?(r=t.reduce(function(t,e){return t.disc_yr<e.disc_yr?t:e}).obs_yr,n=t.reduce(function(t,e){return t.disc_yr>e.disc_yr?t:e}).obs_yr):(r=t.reduce(function(t,e){return t.fcast_yr<e.fcast_yr?t:e}).fcast_yr,n=t.reduce(function(t,e){return t.fcast_yr>e.fcast_yr?t:e}).fcast_yr),console.log("Min "+r+" Max "+n);for(var a="",o=r;o<=n;o++)a+="<th>"+o+"</th>";$("#results-table").append('<tr id="head-row"> <th>EDB</th>'+a+"</tr>");for(var i=[],s=0,c=[],o=0;o<t.length;o++)if(!i.includes(t[o].edb)){i.push(t[o].edb);for(var l="<tr id=row"+o+"><th>"+t[o].edb+"</th>",d=r;d<=n;d++)for(var u=0;u<t.length;u++)t[u].edb===t[o].edb&&(e?t[u].disc_yr:t[u].fcast_yr)===d&&(l+="<th id='t"+s+"'>"+t[u].value+"</th>",c.push({id:"#t"+s,value:t[u].value}),s++);$("#results-table").append(l+"</tr>"),$("#row"+o).click(function(t){showBarWithRowElem(this.id)})}for(var o=0;o<c.length;o++)$(c[o].id).css({background:"-webkit-gradient(linear, left top, right top, color-stop("+c[o].value+"%,#F00), color-stop("+c[o].value+"%,#FFF))"})}function showBarWithRowElem(t){var e=[];$("#results-table").find("tr").removeClass("row-selected"),$("#"+t).addClass("row-selected"),$("#head-row").find("th").each(function(t,r){0!=t&&e.push({category:$(r).text(),value:0})});var r="";$("#"+t).find("th").each(function(t,n){0!=t?e[t-1].value=$(n).text():r=e[t].value=$(n).text()}),createBarGraph(r,e)}function insertCompanies(){$.get("/sections/company",function(t){t.companies.length>0&&$("#company-select").html("<option selected>"+t.companies[0]+"</option>");for(var e=1;e<t.companies.length;e++)$("#company-select").append("<option>"+t.companies[e]+"</option>");$(".selectpicker").selectpicker("refresh")})}function VectorGraphData(t){this.id=t,this.created=!1,this.xAxis=d3.axisBottom(),this.yAxis=d3.axisLeft(),this.x=d3.scaleLinear().rangeRound([vWidth,0]),this.y=d3.scaleLinear().rangeRound([vHeight,0]),this.svg=null}function createVectorGraph(t,e,r,n){n.includes("cd")&&(console.log("CD"),console.log(t));var a=null;vectorGraphs.forEach(function(t){t.id===n&&(a=t)}),null===a&&(a=new VectorGraphData(n),vectorGraphs.push(a));var o=[];t.forEach(function(t){o.push(t.edb)});var i=d3.scaleOrdinal().domain(o).range(["#e69a61","#9817ff","#18c61a","#33b4ff","#c9167e","#297853","#d7011b","#7456c7","#7e6276","#afb113","#fd879c","#fb78fa","#24c373","#45bbc5","#766b21","#abad93","#c19ce3","#fd8f11","#2f56ff","#307a11","#b3483c","#0d7396","#94b665","#9d4d91","#b807c8","#086cbf","#a2abc5","#a35702","#d3084b"]),s=[];t.forEach(function(t){t.years.forEach(function(e){e.edb=t.edb,s.push(e)})});var c=[];s.forEach(function(t){
c.push(t.valueB)});var l=[];s.forEach(function(t){l.push(t.valueA)}),a.created||(a.svg=d3.select(n).append("svg").attr("width",vWidth+vMargin.left+vMargin.right).attr("height",vHeight+vMargin.top+vMargin.bottom).append("g").attr("transform","translate("+vMargin.left+","+vMargin.top+")"));var d=d3.max(c,function(t){return t}),u=d3.max(l,function(t){return t});a.x.domain([d,0]).nice(),a.y.domain([0,u]).nice(),a.created?(a.svg.select(".yAxis").call(a.yAxis),a.svg.select(".xAxis").call(a.xAxis)):(a.xAxis.scale(a.x),a.yAxis.scale(a.y)),a.svg.append("g").attr("class","xAxis").attr("transform","translate(0,"+vHeight+")").attr("stroke","#black").call(a.xAxis.scale(a.x));var p=d3.format(".2f");a.svg.append("g").attr("class","yAxis").attr("fill","black").call(a.yAxis);var h=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return"<strong>EDB:</strong> <span style='color:lightgreen'>"+t.edb+"</span><br><br><strong>Year:</strong> <span style='color:lightgreen'>"+t.year+"</span><br><br><strong>Value:</strong> <span style='color:lightgreen'>["+p(t.valueA)+", "+p(t.valueB)+"]</span>"});a.svg.call(h),a.created?a.svg.selectAll(".dotm").data(s).attr("class","dot").attr("r",3.5).attr("cx",function(t){return a.x(t.valueB)}).attr("cy",function(t){return a.y(t.valueA)}).attr("fill",function(t){return i(t.edb)}).on("mouseover",h.show).on("mouseout",h.hide):a.svg.selectAll(".dotm").data(s).enter().append("circle").attr("class","dotm").attr("r",3.5).attr("cx",function(t){return a.x(t.valueB)}).attr("cy",function(t){return a.y(t.valueA)}).attr("fill",function(t){return i(t.edb)}).on("mouseover",h.show).on("mouseout",h.hide);for(var f=[],g=0;g<t.length;g++)for(var b=0;b<t[g].years.length-1;b++)f.push({end:2016===t[g].years[b].year||2016===t[g].years[b+1].year,edb:t[g].edb,x:t[g].years[b].valueB,y:t[g].years[b].valueA,x1:t[g].years[b+1].valueB,y1:t[g].years[b+1].valueA});if(a.created||a.svg.append("svg:defs").selectAll("marker").data(f).enter().append("svg:marker").attr("id",function(t){if(t.end)return"end"+t.edb.replace(/ /g,"")}).attr("viewBox","0 -5 10 10").attr("refX",9).attr("refY",-.5).attr("markerWidth",9).attr("markerHeight",9).attr("markerUnits","userSpaceOnUse").attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").style("fill",function(t){return i(t.edb)}),a.created?a.svg.selectAll(".line").data(f).attr("x1",function(t){return x(t.x)}).attr("y1",function(t){return y(t.y)}).attr("x2",function(t){return x(t.x1)}).attr("y2",function(t){return y(t.y1)}).attr("stroke-width",2).attr("class",function(t){return""+t.edb.replace(/ /g,"")}).attr("stroke",function(t){return i(t.edb)}).attr("marker-end",function(t){if(t.end)return"url(#end"+t.edb.replace(/ /g,"")+")"}):a.svg.selectAll(".line").data(f).enter().append("line").attr("x1",function(t){return a.x(t.x)}).attr("y1",function(t){return a.y(t.y)}).attr("x2",function(t){return a.x(t.x1)}).attr("y2",function(t){return a.y(t.y1)}).attr("stroke-width",2).attr("class",function(t){return""+t.edb.replace(/ /g,"")}).attr("stroke",function(t){return i(t.edb)}).attr("marker-end",function(t){if(t.end)return"url(#end"+t.edb.replace(/ /g,"")+")"}),a.svg.append("text").attr("text-anchor","middle").attr("transform","translate("+-(vMargin.left/2+15)+","+2*vMargin.top+")rotate(-90)").style("font-size","18px").attr("font-family","sans-serif").attr("class","unit-text").text(r),a.svg.append("text").attr("text-anchor","middle").attr("transform","translate("+vWidth/2+","+(vHeight+35)+")").style("font-size","18px").attr("font-family","sans-serif").attr("class","unit-text").text(e),!a.created){var v=a.svg.append("g").attr("font-family","sans-serif").attr("font-size",10).attr("text-anchor","end").selectAll("g").data(o).enter().append("g").append("svg:a").attr("transform",function(t,e){var r=20*Math.floor(e/5),n=160*(e-5*Math.floor(e/5));return n+=vMargin.left,"translate("+n+","+(r+vHeight+vMargin.bottom/3)+")"}).on("mouseover",function(t){a.svg.selectAll("line."+t.replace(/ /g,"")).classed("line-selected",!0)}).on("mouseout",function(t){a.svg.selectAll("line."+t.replace(/ /g,"")).classed("line-selected",!1)});v.append("circle").attr("cx",vMargin.left+55).attr("cy",9.5).attr("r",7.5).attr("fill",i),v.append("text").attr("x",vMargin.left+40).attr("y",9.5).attr("dy","0.32em").attr("class","g-text").style("font-size","14px").text(function(t){return t})}a.created=!0}var margin={top:60,right:20,bottom:30,left:50},width=550-margin.left-margin.right,height=350-margin.top-margin.bottom,x=d3.scaleBand().range([0,width]).padding(.1),y=d3.scaleLinear().range([height,0]).nice(),yAxis=d3.axisLeft(),created=!1,svg=d3.select("#graph-div").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),margin={top:35,right:85,bottom:150,left:50},width=850-margin.left-margin.right,height=550-margin.top-margin.bottom,barGraphs=[],z=d3.scaleOrdinal().range(["#BBDEFB","#64B5F6","#1976D2","#1565C0","#0D47A1","#d0743c","#ff8c00"]),zRed=d3.scaleOrdinal().range(["#FF7373","#FF4C4C","#FF2626","#B20000","#D90000","#d0743c","#ff8c00"]),zSelected=d3.scaleOrdinal().range(["#C1FFC1","#90EE90","#5BC85B","#31A231","#137B13","#d0743c","#ff8c00"]),whiskBoxWidth=1;!function(){function t(t){return[0,t.length-1]}function e(t){return[d3.quantile(t,.25),d3.quantile(t,.5),d3.quantile(t,.75)]}d3.box=function(){function r(t){t.each(function(t,e){var r=t[1].sort(d3.ascending),i=d3.select(this),u=r.length,p=r[0],h=r[u-1],f=r.quartiles=c(r),g=s&&s.call(this,r,e),y=g&&g.map(function(t){return r[t]}),b=g?d3.range(0,g[0]).concat(d3.range(g[1]+1,u)):d3.range(u),v=d3.scaleLinear().domain(o&&o.call(this,r,e)||[p,h]).range([n,0]),m=this.__chart__||d3.scaleLinear().domain([0,1/0]).range(v.range());this.__chart__=v;var x=i.selectAll("line.center").data(y?[y]:[]);x.enter().insert("line","rect").attr("class","center").attr("x1",whiskBoxWidth/2).attr("y1",function(t){return m(t[0])}).attr("x2",whiskBoxWidth/2).attr("y2",function(t){return m(t[1])}).style("opacity",1e-6).transition().duration(a).style("opacity",1).attr("y1",function(t){return v(t[0])}).attr("y2",function(t){return v(t[1])}),x.transition().duration(a).style("opacity",1).attr("y1",function(t){return v(t[0])}).attr("y2",function(t){return v(t[1])}),x.exit().transition().duration(a).style("opacity",1e-6).attr("y1",function(t){return v(t[0])}).attr("y2",function(t){return v(t[1])}).remove();var w=i.selectAll("rect.box").data([f]);w.enter().append("rect").attr("class","box").attr("x",0).attr("y",function(t){return m(t[2])}).attr("width",whiskBoxWidth).attr("height",function(t){return m(t[0])-m(t[2])}).transition().duration(a).attr("y",function(t){return v(t[2])}).attr("height",function(t){return v(t[0])-v(t[2])}),w.transition().duration(a).attr("y",function(t){return v(t[2])}).attr("height",function(t){return v(t[0])-v(t[2])});var $=i.selectAll("line.median").data([f[1]]);$.enter().append("line").attr("class","median").attr("x1",0).attr("y1",m).attr("x2",whiskBoxWidth).attr("y2",m).transition().duration(a).attr("y1",v).attr("y2",v),$.transition().duration(a).attr("y1",v).attr("y2",v);var C=i.selectAll("line.whisker").data(y||[]);C.enter().insert("line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",m).attr("x2",0+whiskBoxWidth).attr("y2",m).style("opacity",1e-6).transition().duration(a).attr("y1",v).attr("y2",v).style("opacity",1),C.transition().duration(a).attr("y1",v).attr("y2",v).style("opacity",1),C.exit().transition().duration(a).attr("y1",v).attr("y2",v).style("opacity",1e-6).remove();var A=i.selectAll("circle.outlier").data(b,Number);A.enter().insert("circle","text").attr("class","outlier").attr("r",2).attr("cx",whiskBoxWidth/2).attr("cy",function(t){return m(r[t])}).style("opacity",1e-6).transition().duration(a).attr("cy",function(t){return v(r[t])}).style("opacity",1),A.transition().duration(a).attr("cy",function(t){return v(r[t])}).style("opacity",1),A.exit().transition().duration(a).attr("cy",function(t){return v(r[t])}).style("opacity",1e-6).remove();var k=d||v.tickFormat(8),T=i.selectAll("text.box").data(f);1==l&&T.enter().append("text").attr("class","box").attr("dy",".3em").attr("dx",function(t,e){return 1&e?6:-6}).attr("x",function(t,e){return 1&e?+whiskBoxWidth:0}).attr("y",m).attr("text-anchor",function(t,e){return 1&e?"start":"end"}).text(k).transition().duration(a).attr("y",v),T.transition().duration(a).text(k).attr("y",v);var _=i.selectAll("text.whisker").data(y||[]);1==l&&_.enter().append("text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",whiskBoxWidth).attr("y",m).text(k).style("opacity",1e-6).transition().duration(a).attr("y",v).style("opacity",1),_.transition().duration(a).text(k).attr("y",v).style("opacity",1),_.exit().transition().duration(a).attr("y",v).style("opacity",1e-6).remove()}),d3.timerFlush()}var n=1,a=0,o=null,i=Number,s=t,c=e,l=!0,d=null;return r.width=function(t){return arguments.length?(whiskBoxWidth=t,r):whiskBoxWidth},r.height=function(t){return arguments.length?(n=t,r):n},r.tickFormat=function(t){return arguments.length?(d=t,r):d},r.duration=function(t){return arguments.length?(a=t,r):a},d3.functor=function(t){return"function"==typeof t?t:function(){return t}},r.domain=function(t){return arguments.length?(o=null===t?t:d3.functor(t),r):o},r.value=function(t){return arguments.length?(i=t,r):i},r.whiskers=function(t){return arguments.length?(s=t,r):s},r.showLabels=function(t){return arguments.length?(l=t,r):l},r.quartiles=function(t){return arguments.length?(c=t,r):c},r}}();var labels=!1,boxMargin={top:0,right:0,bottom:80,left:100},boxWidth=700-boxMargin.left-boxMargin.right,boxHeight=550-boxMargin.top-boxMargin.bottom,plots=[];String.prototype.includes||(String.prototype.includes=function(){"use strict";return String.prototype.indexOf.apply(this,arguments)!==-1}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,value:function(t){var e=this.filter(function(e){return e==t});return e.length>0}});var regions={n:["Centralines","Counties Power","Eastland Network","Electra","Horizon Energy","Northpower","Powerco","Scanpower","The Lines Company","Top Energy","Unison Networks","Vector Lines","Waipa Networks","WEL Networks","Wellington Electricity"],uni:["Counties Power","Horizon Energy","Northpower","The Lines Company","Top Energy","Vector Lines","Waipa Networks","WEL Networks"],eni:["Centralines","Eastland Network","Scanpower","Unison Networks"],swni:["Electra","Powerco","Wellington Electricity"],s:["Alpine Energy","Aurora Energy","Buller Electricity","Electricity Ashburton","Electricity Invercargill","MainPower NZ","Marlborough Lines","Nelson Electricity","Network Tasman","Network Waitaki","Orion NZ","OtagoNet","The Power Company","Westpower"],usi:["Alpine Energy","Buller Electricity","MainPower NZ","Marlborough Lines","Nelson Electricity","Network Tasman","Orion NZ","Westpower"],lsi:["Aurora Energy","Electricity Ashburton","Electricity Invercargill","Network Waitaki","OtagoNet","The Power Company"],nz:["","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},selections=[],dpFormat=d3.format(".4r"),lastSearch=null,validOptions=[!1,!1,!1,!1],selectedCompany="",dataTables,copyOfDataTables,selectionDataArray,selectionTablesArray,combinedSelectionDataArray;$(document).ready(function(){$(".nav-link").removeClass("active"),$("#benchmarks-link").addClass("active"),$("#company-select").on("change",function(t){selectedCompany=$(this).find("option:selected").text()}),$("#search-btn-compare").click(function(){search2()}),cpiValidationSetup()});var noCPICellsTotals=[],rowSelected="",noCPICells=[];$(document).ready(function(){$(".nav-link").removeClass("active"),$("#core-link").addClass("active"),$.validator.setDefaults({errorClass:"help-block",highlight:function(t){$(t).closest(".form-group").addClass("has-error")},unhighlight:function(t){$(t).closest(".form-group").removeClass("has-error")}});var t={required:!0,number:!0,min:0,max:100},e={required:"Please enter a percentage",number:"Please enter a valid number",min:"Please enter a percentage greater than 0",max:"Please enter a percentage less than 100"};$("#cpi-form").validate({rules:{Y2012:t,Y2013:t,Y2014:t,Y2015:t,Y2016:t},messages:{Y2012:e,Y2013:e,Y2014:e,Y2015:e,Y2016:e}})}),d3.functor=function(t){return"function"==typeof t?t:function(){return t}},d3.tip=function(){function t(t){x=h(t),w=x.createSVGPoint(),document.body.appendChild(m)}function e(){return"n"}function r(){return[0,0]}function n(){return" "}function a(){var t=g();return{top:t.n.y-m.offsetHeight,left:t.n.x-m.offsetWidth/2}}function o(){var t=g();return{top:t.s.y,left:t.s.x-m.offsetWidth/2}}function i(){var t=g();return{top:t.e.y-m.offsetHeight/2,left:t.e.x}}function s(){var t=g();return{top:t.w.y-m.offsetHeight/2,left:t.w.x-m.offsetWidth}}function c(){var t=g();return{top:t.nw.y-m.offsetHeight,left:t.nw.x-m.offsetWidth}}function l(){var t=g();return{top:t.ne.y-m.offsetHeight,left:t.ne.x}}function d(){var t=g();return{top:t.sw.y,left:t.sw.x-m.offsetWidth}}function u(){var t=g();return{top:t.se.y,left:t.e.x}}function p(){var t=d3.select(document.createElement("div"));return t.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),t.node()}function h(t){return t=t.node(),"svg"===t.tagName.toLowerCase()?t:t.ownerSVGElement}function f(){return null===m&&(m=p(),document.body.appendChild(m)),d3.select(m)}function g(){for(var t=$||d3.event.target;"undefined"==typeof t.getScreenCTM&&"undefined"===t.parentNode;)t=t.parentNode;var e={},r=t.getScreenCTM(),n=t.getBBox(),a=n.width,o=n.height,i=n.x,s=n.y;return w.x=i,w.y=s,e.nw=w.matrixTransform(r),w.x+=a,e.ne=w.matrixTransform(r),w.y+=o,e.se=w.matrixTransform(r),w.x-=a,e.sw=w.matrixTransform(r),w.y-=o/2,e.w=w.matrixTransform(r),w.x+=a,e.e=w.matrixTransform(r),w.x-=a/2,w.y-=o/2,e.n=w.matrixTransform(r),w.y+=o,e.s=w.matrixTransform(r),e}var y=e,b=r,v=n,m=p(),x=null,w=null,$=null;t.show=function(){var e=Array.prototype.slice.call(arguments);e[e.length-1]instanceof SVGElement&&($=e.pop());var r,n=v.apply(this,e),a=b.apply(this,e),o=y.apply(this,e),i=f(),s=A.length,c=document.documentElement.scrollTop||document.body.scrollTop,l=document.documentElement.scrollLeft||document.body.scrollLeft;for(i.html(n).style("position","absolute").style("opacity",1).style("pointer-events","all");s--;)i.classed(A[s],!1);return r=C[o].apply(this),i.classed(o,!0).style("top",r.top+a[0]+c+"px").style("left",r.left+a[1]+l+"px"),t},t.hide=function(){var e=f();return e.style("opacity",0).style("pointer-events","none"),t},t.attr=function(e,r){if(arguments.length<2&&"string"==typeof e)return f().attr(e);var n=Array.prototype.slice.call(arguments);return d3.selection.prototype.attr.apply(f(),n),t},t.style=function(e,r){if(arguments.length<2&&"string"==typeof e)return f().style(e);var n=Array.prototype.slice.call(arguments);if(1===n.length){var a=n[0];Object.keys(a).forEach(function(t){return d3.selection.prototype.style.apply(f(),[t,a[t]])})}return t},t.direction=function(e){return arguments.length?(y=null==e?e:d3.functor(e),t):y},t.offset=function(e){return arguments.length?(b=null==e?e:d3.functor(e),t):b},t.html=function(e){return arguments.length?(v=null==e?e:d3.functor(e),t):v},t.destroy=function(){return m&&(f().remove(),m=null),t};var C={n:a,s:o,e:i,w:s,nw:c,ne:l,sw:d,se:u},A=Object.keys(C);return t};var section="",category="",subcategory="",company="",description="",descriptionExists=!1,subExists=!1;$(document).ready(function(){$(".nav-link").removeClass("active"),$("#data-link").addClass("active"),insertCompanies(),$("#section-select").on("change",function(){section=$(this).find("option:selected").text(),$.post("/sections/s",{selected:section},function(t){t.categories.length>0&&$("#category-select").html("");for(var e=0;e<t.categories.length;e++)$("#category-select").append("<option>"+t.categories[e]+"</option>");$(".selectpicker").selectpicker("refresh")})}),$("#category-select").on("change",function(){category=$(this).find("option:selected").text(),$.post("/sections/sc",{category:category,section:section},function(t){if(!(t.subCategories.length>0&&null!==t.subCategories[0]))return void(subExists=!1);subExists=!0,$("#subsection-select").html("");for(var e=0;e<t.subCategories.length;e++)$("#subsection-select").append("<option>"+t.subCategories[e]+"</option>");$(".selectpicker").selectpicker("refresh")})}),$("#subsection-select").on("change",function(){subcategory=$(this).find("option:selected").text(),$.post("/sections/desc",{category:category,section:section,subCategory:subcategory},function(t){if(!(t.descriptions.length>0&&null!==t.descriptions[0]))return void(descriptionExists=!1);descriptionExists=!0,$("#description-select").html("");for(var e=0;e<t.descriptions.length;e++)$("#description-select").append("<option>"+t.descriptions[e]+"</option>");$(".selectpicker").selectpicker("refresh")})}),$("#description-select").on("change",function(){description=$(this).find("option:selected").text()}),$("#company-select").on("change",function(){company=$(this).find("option:selected").text()}),$("#search-btn").click(function(){return""===section?void $("#error").html("Section not selected"):""===category?void $("#error").html("Category not selected"):""===subcategory&&subExists?void $("#error").html("Sub category not selected"):void $.post("/sections/search",{section:section,category:category,subCategory:subcategory,company:company,description:description},function(t){t.rows.length>0?insertDataTable(t.rows):console.log("No results")})})});var vMargin={top:30,right:20,bottom:180,left:70},vWidth=1e3-vMargin.left-vMargin.right,vHeight=800-vMargin.top-vMargin.bottom,vectorGraphs=[];