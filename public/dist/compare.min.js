function Data(){this.rows=[],this.selections=[],this.tables=null,this.copyOfTables=null,this.validOptions=[!1,!1,!1,!1],this.dpFormat=d3.format(".4r")}function loadFromURL(e){searchData=new Data,loadInSections(!0,e),$.post("/compare/search",{company:"",selections:JSON.stringify(e)},function(t){var a=new Selection(e[0],e[1],e[2],e[3]),r=dp.filterRowsToTables(t.rows,a);searchData.rows=t.rows,searchData.tables=r,searchData.copyOfTables=dp.copyDataTables(r),e.forEach(function(e){setSelectionsFromURL(e)}),dataStructure=dp.createDataStructuresWithCopy(searchData.copyOfTables),showTables(dataStructure.selectionTable),showAllRegularGraphs(dataStructure.selectionData,!0),showAllCombinedGraphs(dataStructure.combineData,!0),highlightGraphsOnLoad(dataStructure.selectionTable)})}function highlightGraphsOnLoad(e){for(var t=0;t<e.length;t++)return rowClicked("rowtable"+e[t].id+"0"),void totalsRowClicked("row-tot-"+e[t].id+"0")}function showTables(e){e.forEach(function(e){"ab"===e.id||"cd"===e.id?$("#title-"+e.id).append('<h3 class="subTitle">'+e.title+"</h3><h3>Over</h3>").append('<h3 class="subTitle">'+e.subTitle+"</h3>"):$("#title-"+e.id).append('<h2 class="title">'+e.title+"</h2>").append('<h4 class="subTitle">'+e.subTitle+"</h4>"),insertTable(e.rows,"table"+e.id),insertTotalsTable(e.rows,"table-total"+e.id,regions,!1,!1)})}function showAllRegularGraphs(e,t){e.forEach(function(e){t&&($("#title-"+e.id+"-bar").append('<h3 class="title">'+e.title+"</h3>").append('<h4 class="subTitle">'+e.subTitle+"</h4>"),$("#title-"+e.id+"-box").append('<h3 class="title">'+e.title+"</h3>").append('<h4 class="subTitle">'+e.subTitle+"</h4>"));var a=dp.createDataForGroupedGraph(e.rows);createdGroupedBarGraph(a.data,a.keys,e.unit,"#grouped-bar-"+e.id),createBoxPlot(dp.createDataForBoxPlot(e.rows),"#boxplot"+e.id+"-div",e.unit),$("#full-table-"+e.id+"-div").show()})}function showAllCombinedGraphs(e,t){e.forEach(function(e){t&&($("#title-"+e.id+"-bar").append('<h4 class="combined-title">'+e.title1+'<br><span class="over">over</span><br>'+e.title2+"</h4>"),$("#title-"+e.id+"-box").append('<h4 class="combined-title">'+e.title1+' <br><span class="over">over</span><br>'+e.title2+"</h4>"),$("#title-"+e.id+"-vector").append('<h4 class="combined-title">'+e.title1+'<br><span class="over">over</span><br>'+e.title2+"</h4>"));var a=dp.createDataForGroupedGraph(e.rows);createdGroupedBarGraph(a.data,a.keys,e.unit1+" / "+e.unit2,"#grouped-bar-"+e.id),createBoxPlot(dp.createDataForBoxPlot(e.rows),"#boxplot"+e.id+"-div",e.unit1+" / "+e.unit2),createVectorGraph(dp.createDataForVectorGraph(e.table1Rows,e.table2Rows),e.unit1,e.unit2,"#vector-graph-div-"+e.id),$("#full-table-"+e.id+"-div").show()}),2===e.length&&($("#title-abcd-vec").append('<h4 class="combined-title">'+e[0].title1+" / "+e[0].title2+"</h4>").append("<h4>Over</h4>").append('<h4 class="combined-title">'+e[1].title1+" / "+e[1].title2+"</h4>"),createVectorGraph(dp.createDataForVectorGraph(e[0].rows,e[1].rows),e[0].unit1+" / "+e[1].unit1,e[0].unit2+" / "+e[1].unit2,"#vector-graph-div-abcd"),$("#vector-full-div-abcd").show())}function insertTotalsTable(e,t,a,r,o){var i=t.slice(-2).indexOf("l")>-1?t.slice(-1):t.slice(-2),s={n:"North Island",uni:"Upper North Island",eni:"Eastern North Island",swni:"South-West North Island",s:"South Island",usi:"Upper South Island",lsi:"Lower South Island",nz:"New Zealand"},n=[],c=[];e.forEach(function(e){c.includes(e.obs_yr)||c.push(e.obs_yr)}),c.sort(function(e,t){return+e-+t});var l=dp.createTableTotals(e,a,c),d="";c.forEach(function(e){d+="<th>"+e+"</th>"});var u=0,h=0;o&&$("#"+t).html("");var p=29;$("#"+t).append('<tr id="head-row-totals-'+i+'" class="table-row table-head"> <th>Region</th>'+d+"</tr>");for(var b in l)if(l.hasOwnProperty(b)){var f="<tr class='table-row' id=row-tot-"+i+h+">";f+="<th class='reg-cell'>"+s[b]+"</th>",l[b].forEach(function(e){var t;t="nz"===b?e/p:e/a[b].length,f+="<th id='t-total"+i+u+"' origValue='"+t+"' class='cell'>"+searchData.dpFormat(t)+"</th>",n.push({id:"#t-total"+i+u,value:t}),r||noCPICells.push({id:"t-total"+i+u,value:t}),u++}),$("#"+t).append(f+"</tr>"),$("#row-tot-"+i+h).click(function(){totalsRowClicked(this.id)}),h++}applyGradientCSS(n,!1)}function insertTable(e,t){if(e.sort(function(e,t){return[e.edb,t.edb].sort()[0]===e.edb?-1:1}),0!==e.length){var a=[];e.forEach(function(e){a.includes(e.obs_yr)||a.push(e.obs_yr)}),a.sort(function(e,t){return+e-+t});var r="";a.forEach(function(e){r+="<th>"+e+"</th>"}),$("#"+t).append('<tr id="head-row-'+t+'" class="table-row table-head"> <th>EDB</th>'+r+"</tr>");for(var o=[],i=[],s=0,n=[],c=0,l=0;l<e.length;l++)if(!o.includes(e[l].edb)){o.push(e[l].edb);var d="<tr class='table-row' id=row"+t+c+">";d+="<th class='edb-cell'>"+e[l].edb+"</th>";for(var u=0;u<a.length;u++){for(var h=0;h<e.length;h++)e[h].edb!==e[l].edb||e[h].obs_yr!==a[u]||i.includes(e[h].obs_yr)||(i.push(e[h].obs_yr),d+="<th origValue='"+e[h].value+"' class='cell "+a[u]+"' id='t"+t+s+"'>"+searchData.dpFormat(e[h].value)+"</th>",n.push({id:"#t"+t+s,value:e[h].value}),s++);i=[]}$("#"+t).append(d+"</tr>"),$("#row"+t+c).click(function(e){rowClicked(this.id)}),c++}var p=!0;p=!1,applyGradientCSS(n,p)}}function rowClicked(e){if(rowSelected===e){var t=$("#"+e+" .edb-cell").text();return highlight(t,!0),$(".table-row").find(".edb-cell:contains('"+t+"')").parent().removeClass("row-selected"),d3.selectAll(".line-selected-table").classed("line-selected",!1),d3.selectAll(".vec-dot-selected").classed("vec-dot-selected",!1),void(rowSelected="")}if(""!==rowSelected){var t=$("#"+rowSelected+" .edb-cell").text();$(".table-row").find(".edb-cell:contains('"+t+"')").parent().removeClass("row-selected")}var t=$("#"+e+" .edb-cell").text();rowSelected=e;$("#"+e+".edb-cell").text();$(".table-row").find(".edb-cell:contains('"+t+"')").parent().addClass("row-selected"),d3.selectAll(".line-selected-table").classed("line-selected",!1),d3.selectAll(".vec-dot-selected").classed("vec-dot-selected",!1),highlight(t,!1),d3.selectAll("line."+t.replace(/ /g,"")).classed("line-selected-table",!0),d3.selectAll(".dot."+t.replace(/ /g,"")).classed("vec-dot-selected",!0),$(".table-edb").each(function(){var e=this.id.slice(-2).indexOf("e")>-1?this.id.slice(-1):this.id.slice(-2),a=rowSelected.slice(-1);isNaN(rowSelected.slice(-2))||(a=rowSelected.slice(-2));for(var r="",o=0;o<dataStructure.selectionTable.length;o++)dataStructure.selectionTable[o].id===e&&(r=dataStructure.selectionTable[o].unit);var i="rowtable"+e+a;showBarWithRowElem(i,t,"#bar-"+e,"#head-row-table"+e,"#table"+e,r)})}function updateTableBarGraph(){$(".table-edb").each(function(){var e=this.id.slice(-2).indexOf("e")>-1?this.id.slice(-1):this.id.slice(-2),t=rowSelected.slice(-1);isNaN(rowSelected.slice(-2))||(t=rowSelected.slice(-2));for(var a="",r=0;r<dataStructure.selectionTable.length;r++)dataStructure.selectionTable[r].id===e&&(a=dataStructure.selectionTable[r].unit);var o="rowtable"+e+t,i=$("#"+o+" .edb-cell").text();showBarWithRowElem(o,i,"#bar-"+e,"#head-row-table"+e,"#table"+e,a)})}function updateTotalsBarGraph(){$(".table-tot").each(function(){for(var e=this.id.slice(-2).indexOf("l")>-1?this.id.slice(-1):this.id.slice(-2),t="",a=0;a<dataStructure.selectionTable.length;a++)dataStructure.selectionTable[a].id===e&&(t=dataStructure.selectionTable[a].unit);var r=totalsRowSelectedID.slice(-1),o="row-tot-"+e+r,i=$("#"+o+" .reg-cell").text();showBarWithRowElem(o,i,"#tot-bar-"+e,"#head-row-totals-"+e,"#table-total"+e,t)})}function totalsRowClicked(e){var t=$("#"+e+" .reg-cell").text();if(totalsRowSelectedID===e)return t=$("#"+totalsRowSelectedID+" .reg-cell").text(),$(".table-row").find(".reg-cell:contains('"+t+"')").filter(function(){return $(this).text()===t}).parent().removeClass("row-selected"),void(totalsRowSelectedID="");if(""!==totalsRowSelectedID){var a=$("#"+totalsRowSelectedID+" .reg-cell").text();$(".table-row").find(".reg-cell:contains('"+a+"')").filter(function(){return $(this).text()===a}).parent().removeClass("row-selected")}$(".table-row").find(".reg-cell:contains('"+t+"')").filter(function(){return $(this).text()===t}).parent().addClass("row-selected"),totalsRowSelectedID=e,$(".table-tot").each(function(){for(var e=this.id.slice(-2).indexOf("l")>-1?this.id.slice(-1):this.id.slice(-2),a="",r=0;r<dataStructure.selectionTable.length;r++)dataStructure.selectionTable[r].id===e&&(a=dataStructure.selectionTable[r].unit);var o=totalsRowSelectedID.slice(-1),i="row-tot-"+e+o;showBarWithRowElem(i,t,"#tot-bar-"+e,"#head-row-totals-"+e,"#table-total"+e,a)})}function showBarWithRowElem(e,t,a,r,o,i){var s=[];$(r).find("th").each(function(e,t){0!=e&&s.push({category:$(t).text(),value:0})}),$("#"+e).find("th").each(function(e,t){0!=e?s[e-1].value=$(t).text():title=s[e].value=$(t).text()});var n=-(1/0);$(".cell",o).each(function(){var e=+$(this).attr("origValue");n=e>n?e:n});var c=1/0;$(".cell",o).each(function(){var e=+$(this).attr("origValue");c=e<c?e:c}),createBarGraph(a,n,c,s,t,i)}function applyGradientCSS(e,t){var a=-(1/0);e.forEach(function(e){a=+e.value>a?+e.value:a});for(var r=0;r<e.length;r++){var o=t?o:+e[r].value/a*100;$(e[r].id).css({background:"-webkit-gradient(linear, left top, right top, color-stop("+o+"%,#7bbfd6), color-stop("+o+"%,#FFF))"})}}function search(){if(!dp.validateSearchParams(searchData.selections,searchData.validOptions))return void(error||($("#error-div").append('<h4 style="color : red;">Partial Row Selected</h4>'),error=!0));var e={};searchData.selections.forEach(function(t){""!==t.section&&(e["s"+t.id]=t.section,e["c"+t.id]=t.category,e["sc"+t.id]=t.subCategory,e["d"+t.id]=t.description)}),window.location.replace("compare?"+serialise(e))}function serialise(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}function setSelectionsFromURL(e){getCategoriesFromDatabase(e.section,function(t,a){a||addOptionsToSelector("#category-select"+e.id,t,e.category)}),getSubCategoriesFromDatabase(e.section,e.category,function(t,a){a||(searchData.validOptions[e.id]=!0,addOptionsToSelector("#subsection-select"+e.id,t,e.subCategory))}),getDescriptionsFromDatabase(e.section,e.category,e.subCategory,function(t,a){a||addOptionsToSelector("#description-select"+e.id,t,e.description)})}function loadInSections(e,t){e||(searchData=new Data([],[],[])),$.get("/sections/sections",function(a){if(addSection(0,searchData),addSection(1,searchData),addSection(2,searchData),addSection(3,searchData),e)for(var r=0;r<t.length;r++)searchData.selections[r].description=t[r].description,searchData.selections[r].category=t[r].category,searchData.selections[r].section=t[r].section,searchData.selections[r].subCategory=t[r].subCategory;dp.sortSections(a),searchData.selections.forEach(function(r,o){addOptionsToSelector("#section-select"+r.id,a.sections,e?t[o].section:"")})})}function getCategoriesFromDatabase(e,t){$.post("/sections/s",{selected:e},function(e){e.categories.length>0&&null!==e.categories[0]?t(e.categories,!1):t([],!0)})}function getSubCategoriesFromDatabase(e,t,a){$.post("/sections/sc",{section:e,category:t},function(e){e.subCategories.length>0&&null!==e.subCategories[0]?a(e.subCategories,!1):a([],!0)})}function getDescriptionsFromDatabase(e,t,a,r){$.post("/sections/desc",{category:t,section:e,subCategory:a},function(e){e.descriptions.length>0&&null!==e.descriptions[0]?r(e.descriptions,!1):r(e.descriptions,!0)})}function addOptionsToSelector(e,t,a){$(e).html("");for(var r=0;r<t.length;r++)null!==t[r]&&(t[r]===a?$(e).append("<option selected>"+t[r]+"</option>"):$(e).append("<option>"+t[r]+"</option>"));$(".selectpicker").selectpicker("refresh")}function addSection(e,t){var a=["A","B","C","D","E"];$("#compare-div").append('<div class="row" id="titleRow'+e+'"><div class="col-md-12"><h5  class="selection-title">Make a selection for table '+a[e]+"</h5> </div></div>"),$("#compare-div").append('<div class="row" id="row'+e+'">'),$("#row"+e).append('<div class="col-md-12 compare-col" id="col'+e+'">'),$("#col"+e).append('<button type="button" id="clear-'+e+'" class="btn btn-danger">Clear</button>').on("click",function(e){var t=e.target.id.charAt(e.target.id.length-1);clearSelection(t)}),$("#col"+e).append('<select data-width="250px" class="selectpicker select-compare"  title="Section" id="section-select'+e+'"></select>'),t.selections.push({id:e,section:"",category:"",subCategory:"",description:""}),$("#section-select"+e).on("change",function(a){var r=$(this).find("option:selected").text(),o=a.target.id.charAt(a.target.id.length-1);$("#category-select"+o+",#subsection-select"+o+",#description-select"+o).html(""),t.selections[o]={id:e,section:"",category:"",subCategory:"",description:""},t.validOptions[o]=!1,getCategoriesFromDatabase(r,function(e,t){t||addOptionsToSelector("#category-select"+o,e,"")}),dp.addToSelection(+o,"section",r,t.selections)}),$("#col"+e).append('<select data-width="190px" class="selectpicker select-compare" title="Category" id="category-select'+e+'"></select>'),$("#category-select"+e).on("change",function(e){var a=$(this).find("option:selected").text(),r=+e.target.id.charAt(e.target.id.length-1);$("#description-select"+r).html(""),getSubCategoriesFromDatabase(t.selections[r].section,a,function(e,o){o?getDescriptionsFromDatabase(t.selections[r].section,a,"",function(e,t){t||addOptionsToSelector("#description-select"+r,e,"")}):addOptionsToSelector("#subsection-select"+r,e,"")}),dp.addToSelection(r,"category",a,t.selections)}),$("#col"+e).append('<select data-width="190px" class="selectpicker select-compare" title="Subsection" id="subsection-select'+e+'"></select>'),$("#subsection-select"+e).on("change",function(e){var a=e.target.id.charAt(e.target.id.length-1),r=$(this).find("option:selected").text();getDescriptionsFromDatabase(t.selections[a].section,t.selections[a].category,r,function(e,t){t||addOptionsToSelector("#description-select"+a,e,"")}),dp.addToSelection(a,"subcategory",r,t.selections)}),$("#col"+e).append('<select data-width="190px" class="selectpicker select-compare" title="Description" id="description-select'+e+'"></select>'),$("#description-select"+e).on("change",function(e){var a=e.target.id.charAt(e.target.id.length-1),r=$(this).find("option:selected").text();dp.addToSelection(+a,"description",r,t.selections)})}function clearSelection(e){searchData.selections[e]={id:e,section:"",category:"",subCategory:"",description:""},searchData.validOptions[e]=!1,$("#description-select"+e+",#subsection-select"+e+",#category-select"+e).html(""),$("#section-select"+e).find("option:selected").removeAttr("selected"),$(".selectpicker").selectpicker("refresh")}function cpiValidationSetup(){$.validator.setDefaults({errorClass:"help-block",highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")}});var e={required:!0,number:!0,min:1,max:100},t={required:"Please enter a percentage",number:"Please enter a valid number",min:"Please enter a percentage greater than 0",max:"Please enter a percentage less than 100"};$("#cpi-form").validate({rules:{Y2012:e,Y2013:e,Y2014:e,Y2015:e,Y2016:e},messages:{Y2012:t,Y2013:t,Y2014:t,Y2015:t,Y2016:t}})}function applyCPI(){if($("#cpi-form").valid()){if(noCPICells.length>0){revertCPI();var e=dp.copyDataTables(searchData.tables);dataStructure=dp.createDataStructuresWithCopy(e)}var t=[{year:2012,value:+$("#Y2012").val()},{year:2013,value:+$("#Y2013").val()},{year:2014,value:+$("#Y2014").val()},{year:2015,value:+$("#Y2015").val()},{year:2016,value:+$("#Y2016").val()}];dataStructure.selectionTable.forEach(function(e){e.unit.includes("$")&&applyCPIToTable("#table"+e.id,t)}),dataStructure.selectionData.forEach(function(e){e.unit.includes("$")&&applyCPIToTableRows(e.rows,t)}),dataStructure.selectionTable.forEach(function(e){insertTotalsTable(e.rows,"table-total"+e.id,regions,!0,!0)}),showAllRegularGraphs(dataStructure.selectionData,!1),showAllCombinedGraphs(dataStructure.combineData,!1),updateTableBarGraph(),updateTotalsBarGraph()}}function applyCPIToTableRows(e,t){for(var a=e.reduce(function(e,t){return e.disc_yr<t.disc_yr?e:t}).obs_yr,r=e.reduce(function(e,t){return e.disc_yr>t.disc_yr?e:t}).obs_yr,o=a;o<=r;o++)e.forEach(function(a,r){for(var i=e[r].obs_yr,s=e[r].value,n=0;n<t.length;n++)t[n].year===o&&i<=o&&(s*=1+t[n].value/100);e[r].value=s})}function applyCPIToTable(e,t){$(".cell",e).each(function(){noCPICells.push({id:$(this).attr("id"),value:$(this).text()})});var a=1/0,r=-(1/0);$(".cell",e).each(function(){var e=+$(this).attr("class").split(" ")[1];a=e<a?e:a,r=e>r?e:r});for(var o=a;o<=r;o++)$(".cell",e).each(function(){for(var e=+$(this).attr("class").split(" ")[1],a=$(this).attr("origvalue"),r=0;r<t.length;r++)t[r].year===o&&e<=o&&(a*=1+t[r].value/100,a=searchData.dpFormat(a));$(this).text(a)});applyGradientCSS(noCPICells)}function revertCPI(){noCPICells.forEach(function(e){$("#"+e.id).text(searchData.dpFormat(e.value))}),applyGradientCSS(noCPICells)}function DataProcessor(){}function DataStructure(e,t,a){this.selectionData=e,this.selectionTable=t,this.combineData=a}function Selection(e,t,a,r){this.aTable=e,this.bTable=t,this.cTable=a,this.dTable=r}function DataTables(e,t,a,r,o,i){this.tableA=e,this.tableB=t,this.tableC=a,this.tableD=r,this.tableAB=o,this.tableCD=i}function SelectionData(e,t,a,r,o){this.rows=e,this.title=t,this.subTitle=a,this.id=o,this.unit=r}function SelectionDataCombined(e,t,a,r,o,i,s,n){this.rows=e,this.title1=r,this.title2=o,this.unit1=i,this.unit2=s,this.id=n,this.table1Rows=t,this.table2Rows=a}function SelectedTableData(e,t,a,r,o){this.rows=e,this.id=t,this.title=a,this.subTitle=r,this.unit=o}String.prototype.includes||(String.prototype.includes=function(){"use strict";return String.prototype.indexOf.apply(this,arguments)!==-1}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,value:function(e){var t=this.filter(function(t){return t==e});return t.length>0}});var dp=new DataProcessor,searchData,dataStructure,rowSelected="",totalsRowSelectedID="",noCPICells=[],regions={n:["Centralines","Counties Power","Eastland Network","Electra","Horizon Energy","Northpower","Powerco","Scanpower","The Lines Company","Top Energy","Unison Networks","Vector Lines","Waipa Networks","WEL Networks","Wellington Electricity"],uni:["Counties Power","Horizon Energy","Northpower","The Lines Company","Top Energy","Vector Lines","Waipa Networks","WEL Networks"],eni:["Centralines","Eastland Network","Scanpower","Unison Networks"],swni:["Electra","Powerco","Wellington Electricity"],s:["Alpine Energy","Aurora Energy","Buller Electricity","Electricity Ashburton","Electricity Invercargill","MainPower NZ","Marlborough Lines","Nelson Electricity","Network Tasman","Network Waitaki","Orion NZ","OtagoNet","The Power Company","Westpower"],usi:["Alpine Energy","Buller Electricity","MainPower NZ","Marlborough Lines","Nelson Electricity","Network Tasman","Orion NZ","Westpower"],lsi:["Aurora Energy","Electricity Ashburton","Electricity Invercargill","Network Waitaki","OtagoNet","The Power Company"]};$(document).ready(function(){$(".nav-link").removeClass("active"),$("#benchmarks-link").addClass("active"),$("#search-btn-compare").click(function(){search()}),$(".cpi-form").length>0&&cpiValidationSetup()});var error=!1;DataProcessor.prototype.copyDataTables=function(e){for(var t=[e.tableA,e.tableB,e.tableC,e.tableD,e.tableAB,e.tableCD],a=[[],[],[],[],[],[]],r=0;r<t.length;r++){var o=t[r];if(void 0!==o)for(var i=0;i<o.length;i++)a[r].push({category:o[i].category,description:o[i].description,disc_yr:o[i].disc_yr,edb:o[i].edb,fcast_yr:o[i].fcast_yr,network:o[i].network,note:o[i].note,obs_yr:o[i].obs_yr,p_key:o[i].p_key,sch_ref:o[i].sch_ref,schedule:o[i].schedule,section:o[i].section,sub_category:o[i].sub_category,units:o[i].units,value:o[i].value})}return new DataTables(a[0],a[1],a[2],a[3],a[4],a[5])},DataProcessor.prototype.createDataStructuresWithCopy=function(e){for(var t=[],a=[],r=[],o=[e.tableA.length>0,e.tableB.length>0,e.tableC.length>0,e.tableD.length>0],i=[e.tableA,e.tableB,e.tableC,e.tableD,e.tableAB,e.tableCD],s=["a","b","c","d","ab","cd"],n=0;n<o.length;n++)if(o[n]){var c=i[n][0].section+", "+i[n][0].category,l=null===i[n][0].sub_category?i[n][0].description:i[n][0].sub_category+", "+i[n][0].description;if(a.push(new SelectedTableData(i[n],s[n],l,c,i[n][0].units)),t.push(new SelectionData(i[n],l,c,i[n][0].units,s[n])),("a"===s[n]||"c"===s[n])&&o[n+1]){var d=0===n?4:3,u=i[n+1][0].section+", "+i[n+1][0].category,h=null===i[n+1][0].sub_category?i[n+1][0].description:i[n+1][0].sub_category+", "+i[n+1][0].description;a.push(new SelectedTableData(i[n+d],s[n+d],l+", "+c,h+", "+u,i[n+1][0].units)),r.push(new SelectionDataCombined(i[n+d],i[n],i[n+1],l+" "+c,h+" "+u,i[n][0].units,i[n+1][0].units,s[n+d]))}}return new DataStructure(t,a,r)},DataProcessor.prototype.validateSearchParams=function(e,t){var a=!0;return e.forEach(function(e,r){""===e.subCategory&&t[r]&&(a=!1),""!==e.section&&""!==e.category&&""!==e.description||""===e.section&&""===e.category&&""===e.description||(a=!1)}),a},DataProcessor.prototype.matchDBRow=function(e,t){return e.section===t.section&&e.category===t.category&&e.description===t.description&&(null!==e.sub_category?t.subCategory===e.sub_category:""===t.subCategory)},DataProcessor.prototype.filterRowsToTables=function(e,t){var a=e.filter(function(e){return dp.matchDBRow(e,t.aTable)}),r=e.filter(function(e){return dp.matchDBRow(e,t.bTable)}),o=e.filter(function(e){return dp.matchDBRow(e,t.cTable)}),i=e.filter(function(e){return dp.matchDBRow(e,t.dTable)});if(a.forEach(function(e){null===e.value&&(e.value=0)}),r.forEach(function(e){null===e.value&&(e.value=0)}),o.forEach(function(e){null===e.value&&(e.value=0)}),i.forEach(function(e){null===e.value&&(e.value=0)}),a.length>0&&r.length>0)var s=dp.combineTables(a,r);if(o.length>0&&i.length>0)var n=dp.combineTables(o,i);return new DataTables(a,r,o,i,s,n)},DataProcessor.prototype.combineTables=function(e,t){for(var a=[],r=e,o=t,i=0;i<r.length;i++)for(var s=0;s<o.length;s++)if(r[i].edb===o[s].edb&&r[i].obs_yr===o[s].obs_yr&&r[i].disc_yr===o[s].disc_yr){a.push({disc_yr:o[s].disc_yr,edb:o[s].edb,obs_yr:o[s].obs_yr,value:r[i].value/("0"===o[s].value||0===o[s].value?1:o[s].value),section:o[s].section+""+o[s].description+" over ",description:r[i].section+" "+r[i].description,unitA:r[i].units,unitB:o[s].units,unit:r[i].units+" / "+o[s].units});break}return a},DataProcessor.prototype.createDataForVectorGraph=function(e,t){var a=e,r=t,o=[],i=[],s=[];e.forEach(function(e){if(!s.includes(e.obs_yr))for(var a=0;a<t.length;a++)if(t[a].obs_yr===e.obs_yr){s.push(e.obs_yr);break}});for(var n=0;n<a.length;n++)if(!o.includes(a[n].edb)){var c=a.filter(function(e){return e.edb===a[n].edb}),l=r.filter(function(e){return e.edb===a[n].edb});o.push(a[n].edb);for(var d=[],u=[],h=0;h<c.length;h++)if(!d.includes(c[h].disc_yr)&&s.includes(c[h].disc_yr)){d.push(c[h].disc_yr);var p=c.filter(function(e){return e.disc_yr===c[h].disc_yr}),b=l.filter(function(e){return e.disc_yr===c[h].disc_yr});if(p.length!=b.length)return[];for(var f=0;f<p.length;f++)u.push({year:+p[f].disc_yr,valueA:+p[f].value,valueB:+b[f].value})}u.sort(function(e,t){return e.year-t.year}),i.push({edb:a[n].edb,years:u})}return i},DataProcessor.prototype.createDataForBoxPlot=function(e){for(var t=[],a=[],r=0;r<e.length;r++)t.includes(e[r].obs_yr)||(a.push(e.filter(function(t){return t.obs_yr===e[r].obs_yr})),t.push(e[r].obs_yr));for(var o=[],i=[],s=1/0,n=-(1/0),r=0;r<a.length;r++){var c=[];c[0]=""+a[r][0].obs_yr;for(var l=""+a[r][0].obs_yr,d=[],u=0;u<a[r].length;u++){var h=+a[r][u].value,p=a[r][u].edb;h>n&&(n=h),h<s&&(s=h),d.push(h),i.push({year:l,edb:p,value:h})}c[1]=d,o.push(c)}return o.sort(function(e,t){return e[0]-t[0]}),{min:s,max:n,data:o,scatterData:i}},DataProcessor.prototype.createDataForGroupedGraph=function(e){var t=[];e.forEach(function(e){t.includes(e.obs_yr)||t.push(e.obs_yr)}),t.sort(function(e,t){return+e-+t});for(var a=[],r=[],o=0;o<e.length;o++)if(r.includes(e[o].edb))for(var i=0;i<a.length;i++)a[i].edb===e[o].edb&&(a[i][e[o].obs_yr]=+e[o].value);else{r.push(e[o].edb);var s={edb:e[o].edb};s[e[o].obs_yr]=+e[o].value,a.push(s)}return{data:a,keys:t}},DataProcessor.prototype.sortSections=function(e){e.sections.sort(function(e,t){for(var a=0;!isNaN(e.charAt(a));)a++;var r=e.substring(0,a);for(a=0;!isNaN(t.charAt(a));)a++;var o=t.substring(0,a);return r!==o?r-o:[e,t].sort()[0]===e?-1:1})},DataProcessor.prototype.applyCPIToTableRows=function(e,t){e.forEach(function(a,r){for(var o=e[r].obs_yr,i=e[r].value,s=0;s<t.length;s++)o<=t[s].year&&(i*=1+t[s].value/100);e[r].value=i})},DataProcessor.prototype.addToSelection=function(e,t,a,r){for(var o=0;o<r.length;o++)r[o].id+""==e+""&&("section"===t?r[o].section=a:"category"===t?r[o].category=a:"subcategory"===t?r[o].subCategory=a:"description"===t&&(r[o].description=a))},DataProcessor.prototype.createTableTotals=function(e,t,a){for(var r=["n","uni","eni","swni","s","usi","lsi"],o={},i=0;i<a.length;i++)e.filter(function(e){return e.obs_yr===a[i]}).forEach(function(e){r.forEach(function(a){t[a].includes(e.edb)&&(void 0===o[a]?o[a]=[+e.value]:i===o[a].length?o[a].push(+e.value):o[a][i]+=+ +e.value)})});for(var s=[],i=0;i<a.length;i++)s.push(o.n[i]+o.s[i]);return o.nz=s,o};