function loadFromURL(e){loadInSections(!0,e),lastSearch=new Selection(e[0],e[1],e[2],e[3]),$.post("/compare/search",{company:selectedCompany,selections:JSON.stringify(e)},function(t){setSelectionsFromURL(e[0]),setSelectionsFromURL(e[1]),setSelectionsFromURL(e[2]),setSelectionsFromURL(e[3]),dataTables=filterRowsToTables(t.rows),copyOfDataTables=copyDataTables(dataTables),createDataStructuresWithCopy(copyOfDataTables),showTables(selectionTablesArray),showAllRegularGraphs(selectionDataArray,!0),showAllCombinedGraphs(combinedSelectionDataArray,!0)})}function validateSearchParams(){var e=!0;return selections.forEach(function(t,s){""===t.subCategory&&validOptions[s]&&(e=!1),""!==t.section&&""!==t.category&&""!==t.description||""===t.section&&""===t.category&&""===t.description||($("#error-div").append('<h4 style="color : red;">Partial Row Selected</h4>'),e=!1)}),e&&$("#error-div").html(""),e}function copyDataTables(e){for(var t=[e.tableA,e.tableB,e.tableC,e.tableD,e.tableAB,e.tableCD],s=[[],[],[],[],[],[]],o=0;o<t.length;o++){var i=t[o];if(void 0!==i)for(var r=0;r<i.length;r++)s[o].push({category:i[r].category,description:i[r].description,disc_yr:i[r].disc_yr,edb:i[r].edb,fcast_yr:i[r].fcast_yr,network:i[r].network,note:i[r].note,obs_yr:i[r].obs_yr,p_key:i[r].p_key,sch_ref:i[r].sch_ref,schedule:i[r].schedule,section:i[r].section,sub_category:i[r].sub_category,units:i[r].units,value:i[r].value})}return new DataTables(s[0],s[1],s[2],s[3],s[4],s[5])}function createDataStructuresWithCopy(e){selectionDataArray=[],selectionTablesArray=[],combinedSelectionDataArray=[];for(var t=[e.tableA.length>0,e.tableB.length>0,e.tableC.length>0,e.tableD.length>0],s=[e.tableA,e.tableB,e.tableC,e.tableD,e.tableAB,e.tableCD],o=["a","b","c","d","ab","cd"],i=0;i<t.length;i++)if(t[i]){var r=s[i][0].section+", "+s[i][0].category,a=null===s[i][0].sub_category?s[i][0].description:s[i][0].sub_category+", "+s[i][0].description;if(selectionTablesArray.push(new SelectedTableData(s[i],o[i],r,a,s[i][0].units)),selectionDataArray.push(new SelectionData(s[i],r,a,s[i][0].units,o[i])),("a"===o[i]||"c"===o[i])&&t[i+1]){var n=0===i?4:3,c=s[i+1][0].section+", "+s[i+1][0].category,l=null===s[i+1][0].sub_category?s[i+1][0].description:s[i+1][0].sub_category+", "+s[i+1][0].description;selectionTablesArray.push(new SelectedTableData(s[i+n],o[i+n],r+", "+a,c+", "+l,s[i+1][0].units)),combinedSelectionDataArray.push(new SelectionDataCombined(s[i+n],s[i],s[i+1],r+" "+a,c+" "+l,s[i][0].units,s[i+1][0].units,o[i+n]))}}}function showTables(e){e.forEach(function(e){$("#title-"+e.id).append('<h2 class="title">'+e.title+"</h2>").append('<h4 class="subTitle">'+e.subTitle+"</h4>"),insertTable(e.rows,"table"+e.id),insertTotalsTable(e.rows,"table-total"+e.id,regions,!1)})}function filterRowsToTables(e){var t=e.filter(function(e){return matchDBRow(e,lastSearch.aTable)}),s=e.filter(function(e){return matchDBRow(e,lastSearch.bTable)}),o=e.filter(function(e){return matchDBRow(e,lastSearch.cTable)}),i=e.filter(function(e){return matchDBRow(e,lastSearch.dTable)});if(t.forEach(function(e){null===e.value&&(e.value=0)}),s.forEach(function(e){null===e.value&&(e.value=0)}),o.forEach(function(e){null===e.value&&(e.value=0)}),i.forEach(function(e){null===e.value&&(e.value=0)}),t.length>0&&s.length>0)var r=combineTables(t,s);if(o.length>0&&i.length>0)var a=combineTables(o,i);return new DataTables(t,s,o,i,r,a)}function showAllRegularGraphs(e,t){e.forEach(function(e){t&&($("#title-"+e.id+"-bar").append('<h2 class="title">'+e.title+"</h2>").append('<h4 class="subTitle">'+e.subTitle+"</h4>"),$("#title-"+e.id+"-box").append('<h2 class="title">'+e.title+"</h2>").append('<h4 class="subTitle">'+e.subTitle+"</h4>"));var s=createDataForGroupedGraph(e.rows);createdGroupedBarGraph(s.data,s.keys,e.unit,"#grouped-bar-"+e.id),createBoxPlot(createDataForBoxPlot(e.rows),"#boxplot"+e.id+"-div",e.unit),$("#full-table-"+e.id+"-div").show()})}function showAllCombinedGraphs(e,t){e.forEach(function(e){t&&($("#title-"+e.id+"-bar").append('<h4 class="combined-title">'+e.title1+'<br><span class="over">over</span><br>'+e.title2+"</h4>"),$("#title-"+e.id+"-box").append('<h4 class="combined-title">'+e.title1+' <br><span class="over">over</span><br>'+e.title2+"</h4>"),$("#title-"+e.id+"-vector").append('<h4 class="combined-title">'+e.title1+'<br><span class="over">over</span><br>'+e.title2+"</h4>"));var s=createDataForGroupedGraph(e.rows);createdGroupedBarGraph(s.data,s.keys,e.unit1+" / "+e.unit2,"#grouped-bar-"+e.id),createBoxPlot(createDataForBoxPlot(e.rows),"#boxplot"+e.id+"-div",e.unit1+" / "+e.unit2),createVectorGraph(createDataForVectorGraph(e.table1Rows,e.table2Rows),e.unit1,e.unit2,"#vector-graph-div-"+e.id),$("#full-table-"+e.id+"-div").show()}),2===e.length&&($("#title-abcd-vec").append('<h4 class="combined-title">'+e[0].title1+" / "+e[0].title2+"</h4>").append("<h4>Over</h4>").append('<h4 class="combined-title">'+e[1].title1+" / "+e[1].title2+"</h4>"),createVectorGraph(createDataForVectorGraph(e[0].rows,e[1].rows),e[0].unit1+" / "+e[1].unit1,e[0].unit2+" / "+e[1].unit2,"#vector-graph-div-abcd"),$("#vector-full-div-abcd").show())}function combineTables(e,t){for(var s=[],o=e,i=t,r=0;r<o.length;r++)for(var a=0;a<i.length;a++)if(o[r].edb===i[a].edb&&o[r].obs_yr===i[a].obs_yr&&o[r].disc_yr===i[a].disc_yr){s.push({disc_yr:i[a].disc_yr,edb:i[a].edb,obs_yr:i[a].obs_yr,value:o[r].value/("0"===i[a].value||0===i[a].value?1:i[a].value),section:i[a].section+""+i[a].description+" over ",description:o[r].section+" "+o[r].description,unitA:o[r].units,unitB:i[a].units,unit:o[r].units+" / "+i[a].units});break}return s}function insertTotalsTable(e,t,s,o){var i=[];o&&$("#"+t).html("");var r=[];e.forEach(function(e){r.includes(e.obs_yr)||r.push(e.obs_yr)}),r.sort(function(e,t){return+e-+t});for(var a=["n","uni","eni","swni","s","usi","lsi"],n={n:"North Island",uni:"Upper North Island",eni:"Eastern North Island",swni:"South-West North Island",s:"South Island",usi:"Upper South Island",lsi:"Lower South Island",nz:"New Zealand"},c={},l=0;l<r.length;l++)e.filter(function(e){return e.obs_yr===r[l]}).forEach(function(e){a.forEach(function(t){s[t].includes(e.edb)&&(void 0===c[t]?c[t]=[+e.value]:l===c[t].length?c[t].push(+e.value):c[t][l]+=+ +e.value)})});for(var d=[],l=0;l<r.length;l++)d.push(c.n[l]+c.s[l]);c.nz=d;var u="";r.forEach(function(e){u+="<th>"+e+"</th>"});var p=0;$("#"+t).append('<tr id="head-row-totals-"'+t+' class="table-row table-head"> <th>Region</th>'+u+"</tr>");for(var h in c)if(c.hasOwnProperty(h)){var b="<tr class='table-row' id=row-tot-"+t+l+">";b+="<th class='reg-cell'>"+n[h]+"</th>",c[h].forEach(function(e){b+="<th id='t-total"+t+p+"' origValue='"+e/s[h].length+"' class='val-tot-cell'>"+dpFormat(e/s[h].length)+"</th>",i.push({id:"#t-total"+t+p,value:e/s[h].length}),o||noCPICells.push({id:"t-total"+t+p,value:e/s[h].length}),p++}),$("#"+t).append(b)}applyGradientCSS(i,!1)}function insertTable(e,t){if(e.sort(function(e,t){return[e.edb,t.edb].sort()[0]===e.edb?-1:1}),0!==e.length){var s=[];e.forEach(function(e){s.includes(e.obs_yr)||s.push(e.obs_yr)}),s.sort(function(e,t){return+e-+t});var o=(e.reduce(function(e,t){return e.obs_yr<t.obs_yr?e:t}).obs_yr,e.reduce(function(e,t){return e.obs_yr>t.obs_yr?e:t}).obs_yr,"");s.forEach(function(e){o+="<th>"+e+"</th>"}),$("#"+t).append('<tr id="head-row" class="table-row table-head"> <th>EDB</th>'+o+"</tr>");for(var i=[],r=[],a=0,n=[],c=0;c<e.length;c++)if(!i.includes(e[c].edb)){i.push(e[c].edb);var l="<tr class='table-row' id=row"+t+c+">";l+="<th class='edb-cell'>"+e[c].edb+"</th>";for(var d=0;d<s.length;d++){for(var u=0;u<e.length;u++)e[u].edb!==e[c].edb||e[u].obs_yr!==s[d]||r.includes(e[u].obs_yr)||(r.push(e[u].obs_yr),l+="<th origValue='"+e[u].value+"' class='cell "+s[d]+"' id='t"+t+a+"'>"+dpFormat(e[u].value)+"</th>",n.push({id:"#t"+t+a,value:e[u].value}),a++);r=[]}$("#"+t).append(l+"</tr>"),$("#row"+t+c).click(function(e){rowClicked(this.id)})}var p=!0;p=!1,applyGradientCSS(n,p)}}function rowClicked(e){if(rowSelected===e){var t=$("#"+e+" .edb-cell").text();return highlight(t,!0),$(".table").find("tr").removeClass("row-selected"),d3.selectAll(".line-selected-table").classed("line-selected",!1),d3.selectAll(".vec-dot-selected").classed("vec-dot-selected",!1),void(rowSelected="")}rowSelected=e;var t=$("#"+e+" .edb-cell").text();$(".table").find("tr").removeClass("row-selected"),$("#"+e).addClass("row-selected");$("#"+e+".edb-cell").text();d3.selectAll(".line-selected-table").classed("line-selected",!1),d3.selectAll(".vec-dot-selected").classed("vec-dot-selected",!1),highlight(t,!1),d3.selectAll("line."+t.replace(/ /g,"")).classed("line-selected-table",!0),d3.selectAll(".dot."+t.replace(/ /g,"")).classed("vec-dot-selected",!0)}function applyGradientCSS(e,t){var s=-(1/0);e.forEach(function(e){s=+e.value>s?+e.value:s});for(var o=0;o<e.length;o++){var i=t?i:+e[o].value/s*100;$(e[o].id).css({background:"-webkit-gradient(linear, left top, right top, color-stop("+i+"%,#64B5F6), color-stop("+i+"%,#FFF))"})}}function matchDBRow(e,t){return e.section===t.section&&e.category===t.category&&e.description===t.description&&(null===e.sub_category||t.subCategory===e.sub_category)}function search(){if(validateSearchParams()){var e={i0:selections[0].id,s0:selections[0].section,c0:selections[0].category,sc0:selections[0].subCategory,d0:selections[0].description,i1:selections[1].id,s1:selections[1].section,c1:selections[1].category,sc1:selections[1].subCategory,d1:selections[1].description,i2:selections[2].id,s2:selections[2].section,c2:selections[2].category,sc2:selections[2].subCategory,d2:selections[2].description,i3:selections[3].id,s3:selections[3].section,c3:selections[3].category,sc3:selections[3].subCategory,d3:selections[3].description};params=serialise(e),window.location.replace("compare?"+params)}}function serialise(e){var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t.join("&")}function createDataForVectorGraph(e,t){var s=e,o=t,i=[],r=[],a=[];e.forEach(function(e){if(!a.includes(e.obs_yr))for(var s=0;s<t.length;s++)if(t[s].obs_yr===e.obs_yr){a.push(e.obs_yr);break}});for(var n=0;n<s.length;n++)if(!i.includes(s[n].edb)){var c=s.filter(function(e){return e.edb===s[n].edb}),l=o.filter(function(e){return e.edb===s[n].edb});i.push(s[n].edb);for(var d=[],u=[],p=0;p<c.length;p++)if(!d.includes(c[p].disc_yr)&&a.includes(c[p].disc_yr)){d.push(c[p].disc_yr);var h=c.filter(function(e){return e.disc_yr===c[p].disc_yr}),b=l.filter(function(e){return e.disc_yr===c[p].disc_yr});if(h.length!=b.length)return[];for(var f=0;f<h.length;f++)u.push({year:+h[f].disc_yr,valueA:+h[f].value,valueB:+b[f].value})}u.sort(function(e,t){return e.year-t.year}),r.push({edb:s[n].edb,years:u})}return r}function createDataForBoxPlot(e){for(var t=[],s=[],o=0;o<e.length;o++)t.includes(e[o].obs_yr)||(s.push(e.filter(function(t){return t.obs_yr===e[o].obs_yr})),t.push(e[o].obs_yr));for(var i=[],r=[],a=1/0,n=-(1/0),o=0;o<s.length;o++){var c=[];c[0]=""+s[o][0].obs_yr;for(var l=""+s[o][0].obs_yr,d=[],u=0;u<s[o].length;u++){var p=+s[o][u].value,h=s[o][u].edb;p>n&&(n=p),p<a&&(a=p),d.push(p),r.push({year:l,edb:h,value:p})}c[1]=d,i.push(c)}return i.sort(function(e,t){return e[0]-t[0]}),{min:a,max:n,data:i,scatterData:r}}function createDataForGroupedGraph(e){var t=[];e.forEach(function(e){t.includes(e.obs_yr)||t.push(e.obs_yr)}),t.sort(function(e,t){return+e-+t});for(var s=[],o=[],i=0;i<e.length;i++)if(o.includes(e[i].edb))for(var r=0;r<s.length;r++)s[r].edb===e[i].edb&&(s[r][e[i].obs_yr]=+e[i].value);else{o.push(e[i].edb);var a={edb:e[i].edb};a[e[i].obs_yr]=+e[i].value,s.push(a)}return{data:s,keys:t}}function setSelectionsFromURL(e){$.post("/sections/s",{selected:e.section},function(t){t.categories.length>0&&null!==t.categories[0]&&$("#category-select"+e.id).html("");for(var s=0;s<t.categories.length;s++)t.categories[s]===e.category?$("#category-select"+e.id).append('<option value="'+t.categories[s]+'"selected>'+t.categories[s]+"</option>"):$("#category-select"+e.id).append('<option value="'+t.categories[s]+'">'+t.categories[s]+"</option>");$(".selectpicker").selectpicker("refresh")}),$.post("/sections/sc",{section:e.section,category:e.category},function(t){if(t.subCategories.length>0&&null!==t.subCategories[0]){$("#subsection-select"+e.id).html(""),validOptions[e.id]=!0;for(var s=0;s<t.subCategories.length;s++)t.subCategories[s]===e.subCategory?$("#subsection-select"+e.id).append("<option selected>"+t.subCategories[s]+"</option>"):$("#subsection-select"+e.id).append("<option>"+t.subCategories[s]+"</option>");$(".selectpicker").selectpicker("refresh")}}),$.post("/sections/desc",{category:e.category,section:e.section,subCategory:e.subCategory},function(t){if(t.descriptions.length>0&&null!==t.descriptions[0]){$("#description-select"+e.id).html("");for(var s=0;s<t.descriptions.length;s++)t.descriptions[s]===e.description?$("#description-select"+e.id).append("<option selected>"+t.descriptions[s]+"</option>"):$("#description-select"+e.id).append("<option>"+t.descriptions[s]+"</option>");$(".selectpicker").selectpicker("refresh")}})}function sortSections(e){e.sections.sort(function(e,t){for(var s=0;!isNaN(e.charAt(s));)s++;var o=e.substring(0,s);for(s=0;!isNaN(t.charAt(s));)s++;var i=t.substring(0,s);return o!==i?o-i:[e,t].sort()[0]===e?-1:1})}function loadInSections(e,t){$.get("/sections/sections",function(s){if(addSection(0),addSection(1),addSection(2),addSection(3),e)for(var o=0;o<t.length;o++)selections[o].description=t[o].description,selections[o].category=t[o].category,selections[o].section=t[o].section,selections[o].subCategory=t[o].subCategory;sortSections(s);for(var o=0;o<selections.length;o++){for(var i=0;i<s.sections.length;i++)e&&t[o].section===s.sections[i]?($("#section-select"+selections[o].id).append("<option selected>"+s.sections[i]+"</option>"),validOptions[selections[o].id]=!0):$("#section-select"+selections[o].id).append("<option>"+s.sections[i]+"</option>");$(".selectpicker").selectpicker("refresh")}})}function addSection(e){var t=["A","B","C","D","E"];$("#compare-div").append('<div class="row" id="titleRow'+e+'"><div class="col-md-12"><h5  class="selection-title">Make a selection for table '+t[e]+"</h5> </div></div>"),$("#compare-div").append('<div class="row" id="row'+e+'">'),$("#row"+e).append('<div class="col-md-12 compare-col" id="col'+e+'">'),$("#col"+e).append('<select data-width="250px" class="selectpicker select-compare"  title="Section" id="section-select'+e+'"></select>'),selections.push({id:e,section:"",category:"",subCategory:"",description:""}),$("#section-select"+e).on("change",function(t){var s=$(this).find("option:selected").text(),o=t.target.id.charAt(t.target.id.length-1);$("#category-select"+o).html(""),$("#subsection-select"+o).html(""),$("#description-select"+o).html(""),selections[o]={id:e,section:"",category:"",subCategory:"",description:""},validOptions[o]=!1,$.post("/sections/s",{selected:s},function(e){e.categories.length>0&&null!==e.categories[0]&&$("#category-select"+o).html("");for(var t=0;t<e.categories.length;t++)null!==e.categories[t]&&$("#category-select"+o).append("<option>"+e.categories[t]+"</option>");$(".selectpicker").selectpicker("refresh")}),addToSelection(o,"section",s)}),$("#col"+e).append('<select data-width="190px" class="selectpicker select-compare" title="Category" id="category-select'+e+'"></select>'),$("#category-select"+e).on("change",function(e){var t=$(this).find("option:selected").text(),s=e.target.id.charAt(e.target.id.length-1);$("#description-select"+s).html(""),$.post("/sections/sc",{section:selections[s].section,category:t},function(e){if(!(e.subCategories.length>0&&null!==e.subCategories[0]))return void $.post("/sections/desc",{category:category,section:selections[s].section,subCategory:""},function(e){if(e.descriptions.length>0&&null!==e.descriptions[0]){$("#description-select"+s).html("");for(var t=0;t<e.descriptions.length;t++)$("#description-select"+s).append("<option>"+e.descriptions[t]+"</option>");$(".selectpicker").selectpicker("refresh")}});$("#subsection-select"+s).html(""),validOptions[s]=!0;for(var t=0;t<e.subCategories.length;t++)$("#subsection-select"+s).append("<option>"+e.subCategories[t]+"</option>");$(".selectpicker").selectpicker("refresh"),$(".selectpicker").selectpicker("refresh")}),addToSelection(s,"category",t),$(".selectpicker").selectpicker("refresh")}),$("#col"+e).append('<select data-width="190px" class="selectpicker select-compare" title="Subsection" id="subsection-select'+e+'"></select>'),$("#subsection-select"+e).on("change",function(e){var t=e.target.id.charAt(e.target.id.length-1),s=$(this).find("option:selected").text();$.post("/sections/desc",{category:selections[t].category,section:selections[t].section,subCategory:s},function(e){if(e.descriptions.length>0&&null!==e.descriptions[0]){$("#description-select"+t).html("");for(var s=0;s<e.descriptions.length;s++)$("#description-select"+t).append("<option>"+e.descriptions[s]+"</option>");$(".selectpicker").selectpicker("refresh")}}),addToSelection(t,"subcategory",s)}),$("#col"+e).append('<select data-width="190px" class="selectpicker select-compare" title="Description" id="description-select'+e+'"></select>'),$("#description-select"+e).on("change",function(e){var t=e.target.id.charAt(e.target.id.length-1),s=$(this).find("option:selected").text();addToSelection(t,"description",s)}),$("#col"+e).append('<button type="button" id="clear-'+e+'" class="btn btn-danger">Clear</button>').on("click",function(e){var t=e.target.id.charAt(e.target.id.length-1);clearSelection(t)})}function clearSelection(e){selections[e]={id:e,section:"",category:"",subCategory:"",description:""},validOptions[e]=!1,$("#description-select"+e).html(""),$("#subsection-select"+e).html(""),$("#category-select"+e).html(""),$("#section-select"+e).find("option:selected").removeAttr("selected"),$(".selectpicker").selectpicker("refresh")}function addToSelection(e,t,s){for(var o=0;o<selections.length;o++)selections[o].id+""==e+""&&("section"===t?selections[o].section=s:"category"===t?selections[o].category=s:"subcategory"===t?selections[o].subCategory=s:"description"===t&&(selections[o].description=s))}function cpiValidationSetup(){$.validator.setDefaults({errorClass:"help-block",highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")}});var e={required:!0,number:!0,min:0,max:100},t={required:"Please enter a percentage",number:"Please enter a valid number",min:"Please enter a percentage greater than 0",max:"Please enter a percentage less than 100"};$("#cpi-form").validate({rules:{Y2012:e,Y2013:e,Y2014:e,Y2015:e,Y2016:e},messages:{Y2012:t,Y2013:t,Y2014:t,Y2015:t,Y2016:t}})}function applyCPI(e){if($("#cpi-form").valid()){noCPICells.length>0&&(revertCPI(),copyOfDataTables=copyDataTables(dataTables),createDataStructuresWithCopy(copyOfDataTables));var t=[{year:2012,value:+$("#Y2012").val()},{year:2013,value:+$("#Y2013").val()},{year:2014,value:+$("#Y2014").val()},{year:2015,value:+$("#Y2015").val()},{year:2016,value:+$("#Y2016").val()}];if(selectionTablesArray.forEach(function(e){e.unit.includes("$")&&applyCPIToTable("#table"+e.id,t)}),selectionDataArray.forEach(function(e){e.unit.includes("$")&&applyCPIToTableRows(e.rows,t)}),selectionTablesArray.forEach(function(e){insertTotalsTable(e.rows,"table-total"+e.id,regions,!0)}),showAllRegularGraphs(selectionDataArray,!1),aSelected&&bSelected){var s=combineTables(aRows,bRows);combinedSelectionDataArray[0].rows=s}if(cSelected&&dSelected){var o=combineTables(dataTables.cRows,dataTables.dRows);combinedSelectionDataArray[1].rows=o}showAllCombinedGraphs(combinedSelectionDataArray,!1)}}function applyCPIToTableRows(e,t){for(var s=e.reduce(function(e,t){return e.disc_yr<t.disc_yr?e:t}).obs_yr,o=e.reduce(function(e,t){return e.disc_yr>t.disc_yr?e:t}).obs_yr,i=s;i<=o;i++)e.forEach(function(s,o){for(var r=e[o].obs_yr,a=e[o].value,n=0;n<t.length;n++)t[n].year===i&&r<=i&&(a*=1+t[n].value/100);e[o].value=a})}function applyCPIToTable(e,t){$(".cell",e).each(function(){noCPICells.push({id:$(this).attr("id"),value:$(this).text()})});var s=1/0,o=-(1/0);$(".cell",e).each(function(){var e=+$(this).attr("class").split(" ")[1];s=e<s?e:s,o=e>o?e:o});for(var i=s;i<=o;i++)$(".cell",e).each(function(e){for(var s=+$(this).attr("class").split(" ")[1],o=$(this).attr("origvalue"),r=0;r<t.length;r++)t[r].year===i&&s<=i&&(o*=1+t[r].value/100,o=dpFormat(o));$(this).text(o)});applyGradientCSS(noCPICells)}function revertCPI(){noCPICells.forEach(function(e){$("#"+e.id).text(e.value)}),applyGradientCSS(noCPICells)}function Selection(e,t,s,o){this.aTable=e,this.bTable=t,this.cTable=s,this.dTable=o}function DataTables(e,t,s,o,i,r){this.tableA=e,this.tableB=t,this.tableC=s,this.tableD=o,this.tableAB=i,this.tableCD=r}function SelectionData(e,t,s,o,i){this.rows=e,this.title=t,this.subTitle=s,this.id=i,this.unit=o}function SelectionDataCombined(e,t,s,o,i,r,a,n){this.rows=e,this.title1=o,this.title2=i,this.unit1=r,this.unit2=a,this.id=n,this.table1Rows=t,this.table2Rows=s}function SelectedTableData(e,t,s,o,i){this.rows=e,this.id=t,this.title=s,this.subTitle=o,this.unit=i}String.prototype.includes||(console.log("Does not include the function"),String.prototype.includes=function(){"use strict";return String.prototype.indexOf.apply(this,arguments)!==-1}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,value:function(e){var t=this.filter(function(t){return t==e});return t.length>0}});var regions={n:["Centralines","Counties Power","Eastland Network","Electra","Horizon Energy","Northpower","Powerco","Scanpower","The Lines Company","Top Energy","Unison Networks","Vector Lines","Waipa Networks","WEL Networks","Wellington Electricity"],uni:["Counties Power","Horizon Energy","Northpower","The Lines Company","Top Energy","Vector Lines","Waipa Networks","WEL Networks"],eni:["Centralines","Eastland Network","Scanpower","Unison Networks"],swni:["Electra","Powerco","Wellington Electricity"],s:["Alpine Energy","Aurora Energy","Buller Electricity","Electricity Ashburton","Electricity Invercargill","MainPower NZ","Marlborough Lines","Nelson Electricity","Network Tasman","Network Waitaki","Orion NZ","OtagoNet","The Power Company","Westpower"],usi:["Alpine Energy","Buller Electricity","MainPower NZ","Marlborough Lines","Nelson Electricity","Network Tasman","Orion NZ","Westpower"],lsi:["Aurora Energy","Electricity Ashburton","Electricity Invercargill","Network Waitaki","OtagoNet","The Power Company"],nz:["","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},selections=[],dpFormat=d3.format(".4r"),lastSearch=null,validOptions=[!1,!1,!1,!1],selectedCompany="",aSelected=!1,bSelected=!1,cSelected=!1,dSelected=!1,dataTables,copyOfDataTables,selectionDataArray,selectionTablesArray,combinedSelectionDataArray;$(document).ready(function(){$(".nav-link").removeClass("active"),$("#benchmarks-link").addClass("active"),$("#company-select").on("change",function(e){selectedCompany=$(this).find("option:selected").text()}),$("#search-btn-compare").click(function(){search()}),cpiValidationSetup()});var noCPICellsTotals=[],rowSelected="",noCPICells=[];