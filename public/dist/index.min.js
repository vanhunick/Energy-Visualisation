function insertDataTable(e){console.log("Inserting table"),$("#results-table").append("<caption>"+e[0].description+"</caption>");var t=!1;null!==e[0].obs_yr?(console.log("Observed"),t=!0):null!==e[0].fcast_yr&&console.log("Forecast");var o=null,s=null;t?(o=e.reduce(function(e,t){return e.disc_yr<t.disc_yr?e:t}).obs_yr,s=e.reduce(function(e,t){return e.disc_yr>t.disc_yr?e:t}).obs_yr):(o=e.reduce(function(e,t){return e.fcast_yr<t.fcast_yr?e:t}).fcast_yr,s=e.reduce(function(e,t){return e.fcast_yr>t.fcast_yr?e:t}).fcast_yr),console.log("Min "+o+" Max "+s);for(var n="",c=o;c<=s;c++)n+="<th>"+c+"</th>";$("#results-table").append('<tr id="head-row"> <th>EDB</th>'+n+"</tr>");for(var i=[],r=0,a=[],c=0;c<e.length;c++)if(!i.includes(e[c].edb)){i.push(e[c].edb);for(var l="<tr id=row"+c+"><th>"+e[c].edb+"</th>",d=o;d<=s;d++)for(var u=0;u<e.length;u++)e[u].edb===e[c].edb&&(t?e[u].disc_yr:e[u].fcast_yr)===d&&(l+="<th id='t"+r+"'>"+e[u].value+"</th>",a.push({id:"#t"+r,value:e[u].value}),r++);$("#results-table").append(l+"</tr>"),$("#row"+c).click(function(e){showBarWithRowElem(this.id)})}for(var s=-(1/0),c=0;c<a.length;c++)+a[c].value>s&&(s=+a[c].value),$(a[c].id).css({background:"-webkit-gradient(linear, left top, right top, color-stop("+a[c].value+"%,#F00), color-stop("+a[c].value+"%,#FFF))"});maxTableValue=s}function showBarWithRowElem(e){var t=[];$("#results-table").find("tr").removeClass("row-selected"),$("#"+e).addClass("row-selected"),$("#head-row").find("th").each(function(e,o){0!=e&&t.push({category:$(o).text(),value:0})});var o="";$("#"+e).find("th").each(function(e,s){0!=e?t[e-1].value=$(s).text():o=t[e].value=$(s).text()}),console.log(maxTableValue),createBarGraph("#graph-div",maxTableValue,t)}function insertCompanies(){$.get("/sections/company",function(e){e.companies.length>0&&$("#company-select").html("<option selected>"+e.companies[0]+"</option>");for(var t=1;t<e.companies.length;t++)$("#company-select").append("<option>"+e.companies[t]+"</option>");$(".selectpicker").selectpicker("refresh")})}var section="",category="",subcategory="",company="",description="",descriptionExists=!1,subExists=!1;$(document).ready(function(){$(".nav-link").removeClass("active"),$("#data-link").addClass("active"),insertCompanies(),$("#section-select").on("change",function(){section=$(this).find("option:selected").text(),$.post("/sections/s",{selected:section},function(e){e.categories.length>0&&$("#category-select").html("");for(var t=0;t<e.categories.length;t++)$("#category-select").append("<option>"+e.categories[t]+"</option>");$(".selectpicker").selectpicker("refresh")})}),$("#category-select").on("change",function(){category=$(this).find("option:selected").text(),$.post("/sections/sc",{category:category,section:section},function(e){if(!(e.subCategories.length>0&&null!==e.subCategories[0]))return void(subExists=!1);subExists=!0,$("#subsection-select").html("");for(var t=0;t<e.subCategories.length;t++)$("#subsection-select").append("<option>"+e.subCategories[t]+"</option>");$(".selectpicker").selectpicker("refresh")})}),$("#subsection-select").on("change",function(){subcategory=$(this).find("option:selected").text(),$.post("/sections/desc",{category:category,section:section,subCategory:subcategory},function(e){if(!(e.descriptions.length>0&&null!==e.descriptions[0]))return void(descriptionExists=!1);descriptionExists=!0,$("#description-select").html("");for(var t=0;t<e.descriptions.length;t++)$("#description-select").append("<option>"+e.descriptions[t]+"</option>");$(".selectpicker").selectpicker("refresh")})}),$("#description-select").on("change",function(){description=$(this).find("option:selected").text()}),$("#company-select").on("change",function(){company=$(this).find("option:selected").text()}),$("#search-btn").click(function(){return""===section?void $("#error").html("Section not selected"):""===category?void $("#error").html("Category not selected"):""===subcategory&&subExists?void $("#error").html("Sub category not selected"):void $.post("/sections/search",{section:section,category:category,subCategory:subcategory,company:company,description:description},function(e){e.rows.length>0?insertDataTable(e.rows):console.log("No results")})})});var maxTableValue=0;